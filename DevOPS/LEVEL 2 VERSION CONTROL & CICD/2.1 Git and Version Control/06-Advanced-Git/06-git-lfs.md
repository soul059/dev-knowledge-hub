# Chapter 6.6: Git Large File Storage (LFS)

[← Previous: Tags and Releases](05-tags-and-releases.md) | [Back to README](../README.md) | [Next: Pull Requests →](../07-Collaboration/01-pull-requests.md)

---

## Overview

**Git LFS** (Large File Storage) is a Git extension that replaces large files (binaries, media, datasets) with **text pointers** inside the Git repository, while storing the actual file content on a **separate server**. This keeps repositories fast and manageable.

---

## Why Git LFS?

```
┌──────────────────────────────────────────────────────────────┐
│  THE PROBLEM WITH LARGE FILES IN GIT                        │
│                                                              │
│  Without LFS:                                               │
│  ┌──────────────────────────────────┐                       │
│  │ .git/objects/                     │                       │
│  │  ├── image-v1.psd  (50 MB)       │                       │
│  │  ├── image-v2.psd  (50 MB)       │  Every version        │
│  │  ├── image-v3.psd  (50 MB)       │  stored fully!        │
│  │  ├── video.mp4     (200 MB)      │                       │
│  │  └── model.bin     (100 MB)      │  = 450 MB repo!       │
│  └──────────────────────────────────┘                       │
│                                                              │
│  With LFS:                                                  │
│  ┌──────────────────────────────────┐  ┌─────────────────┐  │
│  │ .git/objects/                     │  │  LFS Server     │  │
│  │  ├── image.psd  (pointer, 130B)  │  │  ├── v1 (50MB)  │  │
│  │  ├── video.mp4  (pointer, 130B)  │  │  ├── v2 (50MB)  │  │
│  │  └── model.bin  (pointer, 130B)  │  │  ├── v3 (50MB)  │  │
│  │                                  │  │  ├── vid (200MB) │  │
│  │  Repo size: ~few KB!             │  │  └── bin (100MB) │  │
│  └──────────────────────────────────┘  └─────────────────┘  │
│                                                              │
│  Clone = fast (pointers only, download files on demand)     │
└──────────────────────────────────────────────────────────────┘
```

---

## How Git LFS Works

```
┌──────────────────────────────────────────────────────────────┐
│       GIT LFS WORKFLOW                                      │
│                                                              │
│  ┌──────────┐   git add   ┌──────────────┐   git push      │
│  │ Working  │ ──────────► │  Staging &   │ ──────────►      │
│  │ Dir      │             │  .git/lfs/   │                  │
│  │ (actual  │             │  (stores the │   ┌──────────┐   │
│  │  file)   │             │   real file) │   │ Git Repo │   │
│  └──────────┘             │              │   │ (pointer │   │
│                           │  .git/objects│   │  only)   │   │
│                           │  (stores     │   └────┬─────┘   │
│                           │   pointer)   │        │         │
│                           └──────────────┘   push LFS       │
│                                                   │         │
│                                              ┌────▼─────┐   │
│                                              │ LFS      │   │
│                                              │ Server   │   │
│                                              │ (actual  │   │
│                                              │  file)   │   │
│                                              └──────────┘   │
└──────────────────────────────────────────────────────────────┘
```

### What a Pointer File Looks Like

```
version https://git-lfs.github.com/spec/v1
oid sha256:4d7a214614ab2935c943f9e0ff69d22eadbb8f32b1258daaa5e2ca24d17e2393
size 12345678
```

---

## Installation

```bash
# macOS
$ brew install git-lfs

# Ubuntu/Debian
$ sudo apt install git-lfs

# Windows (included with Git for Windows, or)
$ choco install git-lfs

# Initialize LFS for your user account (once)
$ git lfs install
```

---

## Tracking Files with LFS

```bash
# Track specific file types
$ git lfs track "*.psd"
$ git lfs track "*.mp4"
$ git lfs track "*.zip"
$ git lfs track "*.bin"

# Track specific files
$ git lfs track "data/large-dataset.csv"

# Track entire directories
$ git lfs track "assets/**"

# IMPORTANT: Add .gitattributes to version control!
$ git add .gitattributes
$ git commit -m "Configure Git LFS tracking"
```

### `.gitattributes` File

```
# Generated by git lfs track commands
*.psd filter=lfs diff=lfs merge=lfs -text
*.mp4 filter=lfs diff=lfs merge=lfs -text
*.zip filter=lfs diff=lfs merge=lfs -text
*.bin filter=lfs diff=lfs merge=lfs -text
```

---

## Common Commands

```bash
# See what's being tracked by LFS
$ git lfs track
# Listing tracked patterns
#   *.psd (.gitattributes)
#   *.mp4 (.gitattributes)

# List all LFS files in the repo
$ git lfs ls-files
# abc1234567 * image.psd
# def8901234 * video.mp4

# Check LFS status
$ git lfs status

# Fetch LFS files without checkout
$ git lfs fetch

# Pull LFS files (fetch + checkout)
$ git lfs pull

# Push LFS files to remote
$ git lfs push origin main

# View LFS environment info
$ git lfs env

# Untrack a file type
$ git lfs untrack "*.psd"

# Migrate existing files to LFS
$ git lfs migrate import --include="*.psd"
```

---

## Migrating Existing Files to LFS

```bash
# Migrate files already in history (rewrites history!)
$ git lfs migrate import --include="*.psd" --everything

# Migrate only in recent commits
$ git lfs migrate import --include="*.psd" --include-ref=main

# Check what would be migrated
$ git lfs migrate info --include="*.psd"

# After migration, force-push (⚠️ coordinate with team!)
$ git push --force-with-lease origin main
```

```
┌──────────────────────────────────────────────────────────────┐
│  ⚠️  MIGRATION REWRITES HISTORY                             │
│                                                              │
│  Before migration:                                          │
│  ●─────●─────●─────●     (large.psd is a regular blob)     │
│                                                              │
│  After migration:                                           │
│  ◆─────◆─────◆─────◆     (large.psd is now an LFS pointer) │
│  (new commit hashes!)                                       │
│                                                              │
│  All team members must re-clone or reset to new history!    │
└──────────────────────────────────────────────────────────────┘
```

---

## File Types to Consider for LFS

| Category | Extensions | Typical Sizes |
|----------|-----------|---------------|
| Images | `.psd`, `.png`, `.jpg`, `.tiff` | 1-500 MB |
| Video/Audio | `.mp4`, `.mov`, `.wav`, `.mp3` | 10 MB - 5 GB |
| Archives | `.zip`, `.tar.gz`, `.rar` | Variable |
| Binaries | `.exe`, `.dll`, `.so`, `.bin` | 1-100 MB |
| Data | `.csv`, `.sqlite`, `.parquet` | 10 MB+ |
| Models | `.h5`, `.pkl`, `.onnx` | 10 MB - 10 GB |
| Game Assets | `.fbx`, `.obj`, `.unity3d` | 1-500 MB |

---

## Real-World Scenarios

### Scenario 1: Setting Up LFS in a New Project

```bash
$ git init my-game-project
$ cd my-game-project
$ git lfs install
$ git lfs track "*.png" "*.fbx" "*.wav" "*.mp4"
$ git add .gitattributes
$ git commit -m "Configure LFS for game assets"
# Now any tracked files will automatically use LFS
$ cp ~/assets/character.fbx .
$ git add character.fbx     # Automatically goes through LFS
$ git commit -m "Add character model"
$ git push origin main      # Pushes pointer + uploads to LFS
```

### Scenario 2: Cloning a Repo with LFS

```bash
# Normal clone fetches LFS pointers + downloads LFS files
$ git clone https://github.com/team/project.git

# Clone WITHOUT downloading LFS files (faster)
$ GIT_LFS_SKIP_SMUDGE=1 git clone https://github.com/team/project.git
# Then selectively pull what you need:
$ git lfs pull --include="textures/*"
```

---

## Troubleshooting Tips

| Problem | Solution |
|---------|----------|
| Files showing as pointer text | Run `git lfs pull` to download actual files |
| "lfs not found" error | Run `git lfs install` to set up hooks |
| `.gitattributes` not committed | Always commit `.gitattributes` after `git lfs track` |
| LFS storage quota exceeded | Check provider limits; clean old files with `git lfs prune` |
| Slow clone with many LFS files | Use `GIT_LFS_SKIP_SMUDGE=1 git clone` then selective pull |
| Migration didn't work | Ensure `--everything` flag; check `git lfs migrate info` |

---

## Summary Table

| Command | Purpose |
|---------|---------|
| `git lfs install` | Initialize LFS for your user |
| `git lfs track "*.ext"` | Track file type with LFS |
| `git lfs untrack "*.ext"` | Stop tracking file type |
| `git lfs track` | Show tracked patterns |
| `git lfs ls-files` | List LFS-managed files |
| `git lfs status` | Show LFS file status |
| `git lfs fetch` | Download LFS files without checkout |
| `git lfs pull` | Fetch + checkout LFS files |
| `git lfs push` | Push LFS files to remote |
| `git lfs migrate import` | Convert existing files to LFS |
| `git lfs prune` | Remove old LFS files locally |
| `git lfs env` | Show LFS configuration |

---

## Quick Revision Questions

1. **What problem does Git LFS solve?**
   <details><summary>Answer</summary>Git LFS solves the problem of bloated repositories caused by large binary files. Without LFS, every version of a large file is stored fully in the Git history, making clones slow and repos huge. LFS replaces large files with small pointer files in Git while storing actual content on a separate server.</details>

2. **What is a pointer file in Git LFS?**
   <details><summary>Answer</summary>A pointer file is a small text file (~130 bytes) that replaces the actual large file in the Git repository. It contains the LFS version, a SHA-256 hash (OID) of the actual file content, and the file size. Git LFS uses this pointer to fetch the real file from the LFS server.</details>

3. **Why must you commit `.gitattributes` after running `git lfs track`?**
   <details><summary>Answer</summary>The `git lfs track` command adds tracking rules to `.gitattributes`. This file must be committed so that all team members have the same LFS tracking configuration. Without it, other contributors won't have LFS enabled for those file types.</details>

4. **How can you clone a repo without downloading LFS files?**
   <details><summary>Answer</summary>Use `GIT_LFS_SKIP_SMUDGE=1 git clone <url>`. This downloads only the pointer files, not the actual large files. You can then selectively download files you need with `git lfs pull --include="path/*"`.</details>

5. **What does `git lfs migrate import` do, and what's the main risk?**
   <details><summary>Answer</summary>It rewrites Git history to convert existing large files into LFS pointers retroactively. The main risk is that it changes commit hashes (rewrites history), so all team members must re-clone or reset to the new history. Always coordinate with your team before running it.</details>

---

[← Previous: Tags and Releases](05-tags-and-releases.md) | [Back to README](../README.md) | [Next: Pull Requests →](../07-Collaboration/01-pull-requests.md)
