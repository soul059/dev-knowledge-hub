# Chapter 5.3: Vulnerability Databases

## Overview

Vulnerability databases are the backbone of SCA tools, providing the known vulnerability data that scanners match against your dependencies. This chapter covers the major databases, how they work, scoring systems (CVSS), and practical usage.

---

## Major Vulnerability Databases

```
VULNERABILITY DATABASE ECOSYSTEM:

  ┌──────────────────────────────────────────────────────────────┐
  │                                                                │
  │  PRIMARY DATABASES                                             │
  │  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐  │
  │  │ NVD (NIST)       │  │ GitHub Advisory │  │ OSV          │  │
  │  │                   │  │ Database        │  │ (Google)     │  │
  │  │ 200,000+ CVEs    │  │ GitHub-curated  │  │ Open Source  │  │
  │  │ CVSS scores      │  │ Ecosystem-      │  │ Vuln DB      │  │
  │  │ Industry standard│  │ specific        │  │ Unified      │  │
  │  └─────────────────┘  └─────────────────┘  └──────────────┘  │
  │                                                                │
  │  ECOSYSTEM-SPECIFIC                                            │
  │  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐  │
  │  │ npm audit        │  │ PyPI / pip-audit│  │ RubyGems     │  │
  │  │ (JavaScript)     │  │ (Python)        │  │ (Ruby)       │  │
  │  └─────────────────┘  └─────────────────┘  └──────────────┘  │
  │                                                                │
  │  COMMERCIAL                                                    │
  │  ┌─────────────────┐  ┌─────────────────┐                     │
  │  │ Snyk Vuln DB     │  │ VulnDB          │                     │
  │  │ (Enhanced + fast)│  │ (Risk-based)    │                     │
  │  └─────────────────┘  └─────────────────┘                     │
  └──────────────────────────────────────────────────────────────┘
```

---

## CVE (Common Vulnerabilities and Exposures)

```
CVE IDENTIFIER STRUCTURE:

  CVE-2021-44228
  │    │     │
  │    │     └── Sequential ID within the year
  │    └──────── Year of assignment
  └───────────── Prefix (always "CVE")

  CVE LIFECYCLE:
  ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐
  │ Discovery│──→│ CNA      │──→│ Published│──→│ Updated  │
  │          │   │ Assigns  │   │ in NVD   │   │ (patches,│
  │          │   │ CVE ID   │   │          │   │ scores)  │
  └──────────┘   └──────────┘   └──────────┘   └──────────┘

  CNA = CVE Numbering Authority (MITRE, vendors, researchers)
```

---

## CVSS (Common Vulnerability Scoring System)

```
CVSS v3.1 SCORING:

  SCORE RANGE:          RATING:         TYPICAL RESPONSE:
  ┌─────────────────────────────────────────────────────────┐
  │  9.0 - 10.0         CRITICAL        Fix within 24 hours │
  │  7.0 -  8.9         HIGH            Fix within 7 days   │
  │  4.0 -  6.9         MEDIUM          Fix within 30 days  │
  │  0.1 -  3.9         LOW             Fix within 90 days  │
  │  0.0                NONE            Informational        │
  └─────────────────────────────────────────────────────────┘

  CVSS VECTOR (Example: Log4Shell):
  CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H  = 10.0

  ┌────────────────┬─────────────────────────────────────┐
  │ Component       │ Meaning                             │
  ├────────────────┼─────────────────────────────────────┤
  │ AV:N           │ Attack Vector: Network              │
  │ AC:L           │ Attack Complexity: Low              │
  │ PR:N           │ Privileges Required: None           │
  │ UI:N           │ User Interaction: None              │
  │ S:C            │ Scope: Changed                      │
  │ C:H            │ Confidentiality Impact: High        │
  │ I:H            │ Integrity Impact: High              │
  │ A:H            │ Availability Impact: High           │
  └────────────────┴─────────────────────────────────────┘

  CVSS METRIC GROUPS:
  ┌───────────────┐  ┌─────────────────┐  ┌────────────────┐
  │ BASE METRICS  │  │ TEMPORAL METRICS│  │ ENVIRONMENTAL  │
  │               │  │                  │  │ METRICS        │
  │ Exploitability│  │ Exploit maturity│  │ Your specific  │
  │ + Impact      │  │ Remediation     │  │ environment    │
  │               │  │ Report conf.    │  │ adjustments    │
  │ (Fixed score) │  │ (Changes over   │  │ (Your context) │
  │               │  │  time)           │  │                │
  └───────────────┘  └─────────────────┘  └────────────────┘
```

---

## Querying Vulnerability Databases

### NVD API

```bash
# Search NVD by CVE ID
curl "https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=CVE-2021-44228" \
    -H "apiKey: YOUR_NVD_API_KEY" | jq '.vulnerabilities[0].cve'

# Search by keyword
curl "https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=log4j" \
    -H "apiKey: YOUR_NVD_API_KEY"

# Search by date range
curl "https://services.nvd.nist.gov/rest/json/cves/2.0?\
pubStartDate=2024-01-01T00:00:00.000&pubEndDate=2024-12-31T23:59:59.999"
```

### OSV (Open Source Vulnerabilities)

```bash
# Query by package
curl -X POST "https://api.osv.dev/v1/query" \
    -d '{
        "package": {
            "name": "lodash",
            "ecosystem": "npm"
        },
        "version": "4.17.20"
    }' | jq '.vulns[] | {id, summary}'

# Query by CVE
curl "https://api.osv.dev/v1/vulns/CVE-2021-44228" | jq '{id, summary, affected}'
```

### Built-in Package Manager Audits

```bash
# npm audit
npm audit
npm audit --json          # Machine-readable
npm audit fix             # Auto-fix compatible updates
npm audit fix --force     # Force major version updates

# pip-audit (Python)
pip install pip-audit
pip-audit
pip-audit --format json
pip-audit --fix            # Auto-fix

# bundle-audit (Ruby)
gem install bundler-audit
bundle-audit check
bundle-audit update        # Update advisory database

# go vuln check
go install golang.org/x/vuln/cmd/govulncheck@latest
govulncheck ./...
```

---

## Vulnerability Prioritization

```
PRIORITIZATION BEYOND CVSS:

  CVSS alone is NOT enough. Consider:

  ┌─────────────────────────────────────────────────────────┐
  │  1. EXPLOITABILITY                                       │
  │  ┌───────────────────────────────────────────────────┐  │
  │  │ Is there a public exploit? (Check Exploit-DB)     │  │
  │  │ Is it actively exploited? (Check CISA KEV)        │  │
  │  │ → CISA KEV = Known Exploited Vulnerabilities      │  │
  │  └───────────────────────────────────────────────────┘  │
  │                                                          │
  │  2. REACHABILITY                                         │
  │  ┌───────────────────────────────────────────────────┐  │
  │  │ Does your code actually call the vulnerable func? │  │
  │  │ → If not, lower priority (but still update)       │  │
  │  └───────────────────────────────────────────────────┘  │
  │                                                          │
  │  3. EXPOSURE                                             │
  │  ┌───────────────────────────────────────────────────┐  │
  │  │ Internet-facing? → Higher priority                │  │
  │  │ Internal only? → Lower priority                   │  │
  │  │ In container? → Consider runtime context          │  │
  │  └───────────────────────────────────────────────────┘  │
  │                                                          │
  │  EFFECTIVE PRIORITY = CVSS × Exploitability             │
  │                       × Reachability × Exposure          │
  └─────────────────────────────────────────────────────────┘
```

---

## EPSS (Exploit Prediction Scoring System)

```
EPSS — PROBABILITY OF EXPLOITATION:

  ┌──────────────────────────────────────────────────────┐
  │ CVSS says: "How bad IF exploited"                     │
  │ EPSS says: "How LIKELY to be exploited"               │
  │                                                        │
  │ Example:                                               │
  │ CVE-A: CVSS 9.8, EPSS 0.01 (1% chance of exploit)   │
  │ CVE-B: CVSS 7.5, EPSS 0.85 (85% chance of exploit)  │
  │                                                        │
  │ → Fix CVE-B first! More likely to be attacked.        │
  │                                                        │
  │ Access: https://api.first.org/data/v1/epss            │
  │ Query:  ?cve=CVE-2021-44228                            │
  └──────────────────────────────────────────────────────┘
```

---

## Troubleshooting Tips

| Problem | Cause | Solution |
|---------|-------|----------|
| CVE not yet in scanner database | NVD publishing delay (can be days) | Cross-reference multiple DBs; check GitHub Advisory directly |
| CVSS score seems wrong for your context | CVSS is generic, not context-specific | Use Environmental metrics to adjust; consider EPSS and reachability |
| npm audit shows vulns in dev dependencies | Audit doesn't distinguish dev/prod | Use `npm audit --omit=dev` for production-only audit |
| Too many low-severity findings | Default settings show all severities | Filter to HIGH/CRITICAL for blocking; track medium quarterly |
| NVD API rate limited | No API key or too many requests | Get free NVD API key; cache results; use bulk data feeds |

---

## Summary Table

| Database | Maintained By | Coverage | Best For |
|----------|--------------|----------|----------|
| **NVD** | NIST (US Gov) | 200K+ CVEs | Industry standard reference |
| **GitHub Advisory** | GitHub | Ecosystem-specific | GitHub-integrated projects |
| **OSV** | Google | Multi-ecosystem | Open source, unified API |
| **CISA KEV** | CISA (US Gov) | Actively exploited | Prioritizing real-world threats |
| **Snyk DB** | Snyk | Enhanced analysis | Commercial SCA users |
| **CVSS** | FIRST.org | Scoring standard | Severity assessment |
| **EPSS** | FIRST.org | Exploitation probability | Prioritization |

---

## Quick Revision Questions

1. **What is a CVE and how is it assigned?**
   > CVE (Common Vulnerabilities and Exposures) is a unique identifier for a publicly known vulnerability (e.g., CVE-2021-44228). It's assigned by CNAs (CVE Numbering Authorities) like MITRE, major vendors, or security researchers, then published in the NVD with CVSS scoring.

2. **What are the three CVSS metric groups?**
   > Base metrics (fixed exploitability and impact scores), Temporal metrics (change over time — exploit maturity, available fixes), and Environmental metrics (organization-specific adjustments based on your deployment context).

3. **Why is CVSS score alone insufficient for prioritization?**
   > CVSS measures severity IF exploited, not likelihood. A CVSS 9.8 vulnerability might have no public exploit and be unreachable in your code, while a CVSS 7.5 with active exploitation (high EPSS) poses greater real-world risk. Effective prioritization combines CVSS, EPSS, reachability, and exposure.

4. **What is EPSS and how does it complement CVSS?**
   > EPSS (Exploit Prediction Scoring System) predicts the probability that a vulnerability will be exploited in the wild within 30 days. While CVSS says "how bad IF exploited," EPSS says "how likely to BE exploited." Together they enable risk-based prioritization.

5. **What is the CISA KEV catalog?**
   > CISA Known Exploited Vulnerabilities catalog lists CVEs confirmed to be actively exploited in the wild. If a CVE is on this list, it should be treated as maximum priority regardless of CVSS score, as attackers are already using it.

---

[← Previous: 5.2 SCA Tools](02-sca-tools.md) | [Next: 5.4 License Compliance →](04-license-compliance.md)

[Back to Table of Contents](../README.md)
