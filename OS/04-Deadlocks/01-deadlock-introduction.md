# Chapter 4.1: Deadlock Introduction

## Overview

A deadlock is a situation where a set of processes are blocked because each process is holding a resource and waiting for another resource held by another process in the set. Understanding deadlocks is crucial for designing reliable systems.

---

## What is a Deadlock?

### Definition

A **Deadlock** is a state where each member of a group of processes is waiting for an event that can only be caused by another member of the group.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DEADLOCK SCENARIO                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚      â”‚   P1    â”‚ â”€â”€â”€â”€â”€ holds â”€â”€â”€â”€â”€â”€â†’ â”‚   R1    â”‚                â”‚
â”‚      â”‚         â”‚ â†â”€â”€â”€â”€ wants â”€â”€â”€â”€â”€â”€â”€ â”‚         â”‚                â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚                               â†‘                      â”‚
â”‚           â”‚                               â”‚                      â”‚
â”‚        wants                           holds                     â”‚
â”‚           â”‚                               â”‚                      â”‚
â”‚           â†“                               â”‚                      â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚      â”‚   R2    â”‚ â†â”€â”€â”€â”€ holds â”€â”€â”€â”€â”€â”€â”€ â”‚   P2    â”‚                â”‚
â”‚      â”‚         â”‚ â”€â”€â”€â”€â”€ wants â”€â”€â”€â”€â”€â”€â†’ â”‚         â”‚                â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                  â”‚
â”‚  P1 holds R1, wants R2                                          â”‚
â”‚  P2 holds R2, wants R1                                          â”‚
â”‚  Neither can proceed â†’ DEADLOCK!                                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Real-World Analogy: Traffic Gridlock

```
                    â†‘
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
   â†â”€â”€â”€â”€â”¤    [Car A]  [Car B]   â”œâ”€â”€â”€â”€â†’
        â”‚                       â”‚
        â”‚    [Car D]  [Car C]   â”‚
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â†“

Four cars at an intersection, each waiting for the car 
on their right to move first. Nobody can move!
```

---

## System Model

### Resources

A system consists of a finite number of resources distributed among processes.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RESOURCE TYPES                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Resource Types (R1, R2, ..., Rm)                               â”‚
â”‚                                                                  â”‚
â”‚  Examples:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Resource Type    â”‚ Instances                  â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ CPU cycles       â”‚ Multiple cores             â”‚              â”‚
â”‚  â”‚ Memory           â”‚ Multiple pages             â”‚              â”‚
â”‚  â”‚ I/O devices      â”‚ Multiple printers          â”‚              â”‚
â”‚  â”‚ Files            â”‚ Multiple files             â”‚              â”‚
â”‚  â”‚ Semaphores       â”‚ Multiple locks             â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”‚  Each resource type Ri has Wi instances                         â”‚
â”‚  Example: R1 (printers) has 3 instances                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Resource Usage Protocol

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RESOURCE USAGE SEQUENCE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. REQUEST                                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚     â”‚ Process requests the resource                  â”‚          â”‚
â”‚     â”‚ If not available: process waits                â”‚          â”‚
â”‚     â”‚ System call: open(), allocate(), request()     â”‚          â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                         â†“                                        â”‚
â”‚  2. USE                                                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚     â”‚ Process uses the resource                      â”‚          â”‚
â”‚     â”‚ E.g., print to printer, write to file          â”‚          â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                         â†“                                        â”‚
â”‚  3. RELEASE                                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚     â”‚ Process releases the resource                  â”‚          â”‚
â”‚     â”‚ Resource becomes available for others          â”‚          â”‚
â”‚     â”‚ System call: close(), free(), release()        â”‚          â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Conditions for Deadlock

For a deadlock to occur, ALL FOUR conditions must hold simultaneously:

### 1. Mutual Exclusion

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MUTUAL EXCLUSION                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  At least one resource must be held in a non-shareable mode     â”‚
â”‚                                                                  â”‚
â”‚        Resource R                                                â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚        â”‚ LOCKED â”‚ â†â”€â”€ Held by P1                                â”‚
â”‚        â”‚   ğŸ”’   â”‚                                               â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚            â†‘                                                     â”‚
â”‚            â”‚                                                     â”‚
â”‚     P2: "I need R!"                                             â”‚
â”‚     Must wait, cannot share                                      â”‚
â”‚                                                                  â”‚
â”‚  Examples: Printer, tape drive, mutex lock                      â”‚
â”‚  Counter-example: Read-only file (can be shared)                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Hold and Wait

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HOLD AND WAIT                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  A process holds at least one resource while waiting for        â”‚
â”‚  additional resources held by other processes                   â”‚
â”‚                                                                  â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚        â”‚   R1   â”‚          â”‚   R2   â”‚                           â”‚
â”‚        â”‚ (held) â”‚          â”‚ (held) â”‚                           â”‚
â”‚        â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                           â”‚
â”‚            â”‚                   â”‚                                 â”‚
â”‚            â†“                   â†“                                 â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚        â”‚  P1   â”‚   wants   â”‚  P2   â”‚                            â”‚
â”‚        â”‚       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚       â”‚                            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                  â”‚
â”‚  P1 holds R1 and waits for R2 (held by P2)                     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. No Preemption

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NO PREEMPTION                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Resources cannot be forcibly taken away from a process         â”‚
â”‚  A resource can only be released voluntarily by the holder      â”‚
â”‚                                                                  â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚        â”‚  P1   â”‚ â”€â”€holdsâ”€â†’â”‚   R1   â”‚                            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                               â†‘                                  â”‚
â”‚                               â”‚                                  â”‚
â”‚        OS: "Sorry, I cannot forcibly take R1 from P1"           â”‚
â”‚             (No preemption allowed)                              â”‚
â”‚                                                                  â”‚
â”‚  This condition applies to resources like:                      â”‚
â”‚  â€¢ Mutex locks                                                  â”‚
â”‚  â€¢ Files in write mode                                          â”‚
â”‚                                                                  â”‚
â”‚  Does NOT apply to:                                             â”‚
â”‚  â€¢ CPU (can be preempted)                                       â”‚
â”‚  â€¢ Memory (can be swapped)                                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Circular Wait

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CIRCULAR WAIT                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  A circular chain of processes exists where each process holds  â”‚
â”‚  resource(s) needed by the next process in the chain            â”‚
â”‚                                                                  â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚            â”‚   P1   â”‚                                           â”‚
â”‚            â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                           â”‚
â”‚         holds R1â”‚ â†‘ wants R4                                    â”‚
â”‚                â†“ â”‚                                               â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â” â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚        â”‚  R1   â”‚            â”‚                                   â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                                   â”‚
â”‚             â†“               â”‚                                   â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚        â”‚   P2   â”‚      â”‚   P4   â”‚                               â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚         holds R2â†“      â†‘holds R4                                â”‚
â”‚                â†“       â”‚                                         â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚        â”‚  R2   â”‚  â”‚   R3   â”‚                                    â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚             â†“          â†‘                                         â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” holds R3                                      â”‚
â”‚        â”‚   P3   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                  â”‚
â”‚  P1 â†’ P2 â†’ P3 â†’ P4 â†’ P1 (circular)                             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Summary: All Four Conditions

| Condition | Description | Required? |
|-----------|-------------|-----------|
| **Mutual Exclusion** | Non-shareable resource | YES |
| **Hold and Wait** | Hold one, wait for another | YES |
| **No Preemption** | Cannot forcibly take resource | YES |
| **Circular Wait** | Cycle of waiting processes | YES |

```
DEADLOCK occurs âŸº All four conditions simultaneously true

If ANY condition is prevented â†’ No deadlock possible
```

---

## Resource Allocation Graph (RAG)

### Components

A directed graph to visualize resource allocation:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RESOURCE ALLOCATION GRAPH NOTATION                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Vertices:                                                       â”‚
â”‚  â€¢ Processes: P = {P1, P2, ..., Pn} represented as circles      â”‚
â”‚  â€¢ Resources: R = {R1, R2, ..., Rm} represented as rectangles   â”‚
â”‚                                                                  â”‚
â”‚      â—‹         Process                                          â”‚
â”‚     P1                                                          â”‚
â”‚                                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚    â”‚ â— â—  â”‚    Resource type with 2 instances (dots)            â”‚
â”‚    â”‚  R1  â”‚                                                     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚                                                                  â”‚
â”‚  Edges:                                                          â”‚
â”‚  â€¢ Request edge: Pi â†’ Rj (Process Pi requests resource Rj)      â”‚
â”‚  â€¢ Assignment edge: Rj â†’ Pi (Resource Rj assigned to Pi)        â”‚
â”‚                                                                  â”‚
â”‚      â—‹                           â”Œâ”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚     Pi â”€â”€â”€â”€â”€â”€â”€ request â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Rj  â”‚                       â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                  â”‚
â”‚      â—‹                           â”Œâ”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚     Pi â†â”€â”€â”€â”€â”€â”€ assignment â”€â”€â”€â”€â”€â”€ â”‚  Rj  â”‚                       â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Example RAG

```
Process P1 holds R1 and requests R2
Process P2 holds R2 and requests R1

    â—‹ P1 â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚               â”‚ â— R1   â”‚
     â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ request
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â—‹ P2
â”‚ â— R2   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  assignment   â”‚
     â†‘                   â”‚
     â”‚                   â”‚ request
     â”‚                   â†“
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ â— R1   â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

This graph shows a CYCLE â†’ Potential deadlock!
```

### RAG with Single Instance Resources

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SINGLE INSTANCE RESOURCES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  If each resource type has exactly ONE instance:                â”‚
â”‚                                                                  â”‚
â”‚  Cycle in RAG âŸº DEADLOCK exists                                 â”‚
â”‚                                                                  â”‚
â”‚  Example: Deadlock                                               â”‚
â”‚                                                                  â”‚
â”‚          â—‹ P1                   â—‹ P2                            â”‚
â”‚         /    \                 /    \                           â”‚
â”‚     holds    wants         holds    wants                       â”‚
â”‚       â†“        â†“             â†“        â†“                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”                       â”‚
â”‚    â”‚ R1 â”‚   â”‚ R2 â”‚       â”‚ R2 â”‚   â”‚ R1 â”‚                       â”‚
â”‚    â””â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                  â”‚
â”‚    Combined graph has cycle: P1 â†’ R2 â†’ P2 â†’ R1 â†’ P1             â”‚
â”‚    DEADLOCK!                                                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RAG with Multiple Instance Resources

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               MULTIPLE INSTANCE RESOURCES                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  If resources have MULTIPLE instances:                          â”‚
â”‚                                                                  â”‚
â”‚  Cycle in RAG â†’ May or may not be deadlock                     â”‚
â”‚                                                                  â”‚
â”‚  Example: Cycle but NO Deadlock                                 â”‚
â”‚                                                                  â”‚
â”‚       â—‹ P1 â”€â”€â”€â”€wantsâ”€â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                           â”‚ â— â— R1 â”‚ â† 2 instances             â”‚
â”‚       â—‹ P2 â†â”€â”€holdsâ”€â”€â”€â”€â”€â”€ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚        â”‚                       â”‚                                â”‚
â”‚        â”‚                       â”‚                                â”‚
â”‚     wants                   holds                               â”‚
â”‚        â†“                       â†“                                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”               â—‹ P3                               â”‚
â”‚    â”‚ â— â— R2 â”‚ â†â”€â”€holdsâ”€â”€â”€â”€â”€                                    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚        â”‚                                                        â”‚
â”‚     holds                                                       â”‚
â”‚        â†“                                                        â”‚
â”‚       â—‹ P4                                                      â”‚
â”‚                                                                  â”‚
â”‚  Cycle: P1 â†’ R1 â†’ P2 â†’ R2 â†’ P1                                 â”‚
â”‚  But P3 or P4 might release â†’ No deadlock!                     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deadlock vs Starvation vs Livelock

| Condition | Description | Processes Running? |
|-----------|-------------|-------------------|
| **Deadlock** | Circular waiting, no progress possible | No (blocked) |
| **Starvation** | Process indefinitely postponed | Others run, one starves |
| **Livelock** | Processes change state but no progress | Yes, but useless work |

### Livelock Example

```
Two people in a corridor:

Person A: Step right   Person B: Step left
Person A: Step left    Person B: Step right
Person A: Step right   Person B: Step left
...

Both keep moving but never get past each other!
Unlike deadlock, they ARE doing work, just not useful work.
```

---

## Summary

| Concept | Description |
|---------|-------------|
| **Deadlock** | Circular waiting for resources |
| **Four Conditions** | Mutual exclusion, Hold-wait, No preemption, Circular wait |
| **RAG** | Graph showing allocation and requests |
| **Single Instance** | Cycle = Deadlock |
| **Multiple Instance** | Cycle may or may not be deadlock |

---

## Quick Revision Questions

1. Define deadlock and give a real-world example.
2. List and explain the four necessary conditions for deadlock.
3. What is a Resource Allocation Graph?
4. How does the deadlock analysis differ for single vs multiple instance resources?
5. What is the difference between deadlock and livelock?

---

[â† Previous: Monitors](../03-Process-Synchronization/05-monitors.md) | [Next: Deadlock Handling â†’](./02-deadlock-handling.md)
