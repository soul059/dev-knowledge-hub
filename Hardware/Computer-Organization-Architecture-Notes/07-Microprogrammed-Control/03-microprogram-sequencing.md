# Chapter 7.3: Microprogram Sequencing

## ğŸ“‹ Chapter Overview

Microprogram sequencing determines how the control unit moves from one microinstruction to the next. This chapter covers next-address logic, branching mechanisms, and microprogram subroutines.

---

## ğŸ¯ Learning Objectives

- Understand next-address generation methods
- Study conditional and unconditional branching
- Learn microsubroutine implementation
- Analyze address selection logic

---

## 1. Sequencing Methods Overview

### ğŸ“Œ How to Get Next Microaddress

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MICROPROGRAM SEQUENCING METHODS                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Four ways to determine the next microinstruction address:             â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   1. SEQUENTIAL                                                   â”‚ â”‚
â”‚   â”‚      Î¼AR â† Î¼AR + 1                                               â”‚ â”‚
â”‚   â”‚      Default behavior; execute microinstructions in order        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   2. UNCONDITIONAL BRANCH                                        â”‚ â”‚
â”‚   â”‚      Î¼AR â† Address from microinstruction                         â”‚ â”‚
â”‚   â”‚      Jump to specified microaddress (always taken)               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   3. CONDITIONAL BRANCH                                          â”‚ â”‚
â”‚   â”‚      if (condition) Î¼AR â† Address                                â”‚ â”‚
â”‚   â”‚      else Î¼AR â† Î¼AR + 1                                          â”‚ â”‚
â”‚   â”‚      Branch depends on status flags or conditions                â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   4. MAPPING (Dispatch)                                          â”‚ â”‚
â”‚   â”‚      Î¼AR â† Map(IR opcode)                                        â”‚ â”‚
â”‚   â”‚      Convert machine instruction opcode to microprogram start    â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Visual:                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Sequential:        Unconditional:     Conditional:             â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”                   â”‚ â”‚
â”‚   â”‚   â”‚ 10 â”‚             â”‚ 10 â”‚             â”‚ 10 â”‚ if Z=1            â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”¬â”€â”˜             â””â”€â”€â”¬â”€â”˜             â””â”€â”€â”¬â”€â”˜                   â”‚ â”‚
â”‚   â”‚      â”‚                  â”‚                  â”‚\                     â”‚ â”‚
â”‚   â”‚      â–¼                  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ \                   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”                â”‚    â–¼                â–¼                   â”‚ â”‚
â”‚   â”‚   â”‚ 11 â”‚                â”‚ â”Œâ”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”                â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”¬â”€â”˜                â”‚ â”‚ 11 â”‚           â”‚ 50 â”‚                â”‚ â”‚
â”‚   â”‚      â”‚                  â”‚ â””â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”˜                â”‚ â”‚
â”‚   â”‚      â–¼                  â”‚   Z=0             Z=1                  â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”                â–¼                                         â”‚ â”‚
â”‚   â”‚   â”‚ 12 â”‚             â”Œâ”€â”€â”€â”€â”          Mapping:                    â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”˜             â”‚ 50 â”‚          Opcode â†’ Î¼Addr              â”‚ â”‚
â”‚   â”‚                      â””â”€â”€â”€â”€â”˜          ADD â†’ 32                    â”‚ â”‚
â”‚   â”‚                                      SUB â†’ 48                    â”‚ â”‚
â”‚   â”‚                                      LOAD â†’ 64                   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Next Address Logic

### ğŸ“Œ Address Selection Hardware

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NEXT ADDRESS SELECTION LOGIC                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚   â”‚   â”‚            MICROINSTRUCTION REGISTER (Î¼IR)                   â”‚â”‚ â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚ â”‚
â”‚   â”‚   â”‚  â”‚  Control  â”‚   ALU     â”‚ CD  â”‚ BR  â”‚   Address (AD)   â”‚   â”‚â”‚ â”‚
â”‚   â”‚   â”‚  â”‚  Fields   â”‚   Op      â”‚     â”‚     â”‚                  â”‚   â”‚â”‚ â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚ â”‚
â”‚   â”‚   â”‚                             â”‚     â”‚           â”‚             â”‚â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚   â”‚                                 â”‚     â”‚           â”‚               â”‚ â”‚
â”‚   â”‚                                 â–¼     â–¼           â–¼               â”‚ â”‚
â”‚   â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚   â”‚                           â”‚     ADDRESS SELECTOR        â”‚        â”‚ â”‚
â”‚   â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚   â”‚                                 â–²     â–²           â–²               â”‚ â”‚
â”‚   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚           â”‚               â”‚ â”‚
â”‚   â”‚         â–¼                             â”‚           â”‚               â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚           â”‚               â”‚ â”‚
â”‚   â”‚   â”‚  CONDITION    â”‚                   â”‚           â”‚               â”‚ â”‚
â”‚   â”‚   â”‚  MUX          â”‚                   â”‚           â”‚               â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚           â”‚               â”‚ â”‚
â”‚   â”‚           â–²                           â”‚           â”‚               â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚           â”‚               â”‚ â”‚
â”‚   â”‚   Z  C  S  I  ...                     â”‚           â”‚               â”‚ â”‚
â”‚   â”‚   (Status Flags)                      â”‚           â”‚               â”‚ â”‚
â”‚   â”‚                                       â”‚           â”‚               â”‚ â”‚
â”‚   â”‚                                       â”‚           â”‚               â”‚ â”‚
â”‚   â”‚   Sources for Next Address:          â”‚           â”‚               â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚   â”‚   â”‚                                                          â”‚   â”‚ â”‚
â”‚   â”‚   â”‚  1. Î¼AR + 1         â† From incrementer                   â”‚   â”‚ â”‚
â”‚   â”‚   â”‚  2. AD field        â† From current Î¼instruction          â”‚   â”‚ â”‚
â”‚   â”‚   â”‚  3. Mapping logic   â† From IR opcode                     â”‚   â”‚ â”‚
â”‚   â”‚   â”‚  4. Subroutine stackâ† Return address                     â”‚   â”‚ â”‚
â”‚   â”‚   â”‚                                                          â”‚   â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚   â”‚                                 â”‚                                 â”‚ â”‚
â”‚   â”‚                                 â–¼                                 â”‚ â”‚
â”‚   â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚ â”‚
â”‚   â”‚                          â”‚    Î¼AR    â”‚                            â”‚ â”‚
â”‚   â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚ â”‚
â”‚   â”‚                                 â”‚                                 â”‚ â”‚
â”‚   â”‚                                 â–¼                                 â”‚ â”‚
â”‚   â”‚                         Control Memory                            â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Œ Selection Logic Implementation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADDRESS SELECTOR DETAIL                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Î¼AR + 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚   â”‚   (Incrementer output)                                 â”‚          â”‚ â”‚
â”‚   â”‚                                                        â”‚          â”‚ â”‚
â”‚   â”‚   AD field â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚ â”‚
â”‚   â”‚   (Branch address from Î¼IR)                           â”‚   â”Œâ”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚                                                        â”œâ”€â”€â–ºâ”‚4:1 â”‚ â”‚ â”‚
â”‚   â”‚   Mapping output â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚MUX â”‚â”€â–ºÎ¼AR
â”‚   â”‚   (Opcode lookup)                                     â”‚   â”‚    â”‚ â”‚ â”‚
â”‚   â”‚                                                        â”‚   â””â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â”‚   SBR (Subroutine Register) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â–²   â”‚ â”‚
â”‚   â”‚   (Return address)                                           â”‚   â”‚ â”‚
â”‚   â”‚                                                              â”‚   â”‚ â”‚
â”‚   â”‚   â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”‚   â”‚ â”‚
â”‚   â”‚                                                              â”‚   â”‚ â”‚
â”‚   â”‚   Selection Logic (generates MUX select):                   â”‚   â”‚ â”‚
â”‚   â”‚                                                              â”‚   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ â”‚
â”‚   â”‚   â”‚                                                          â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   Inputs: BR (2 bits), CD (2 bits), Status flags        â”‚   â”‚ â”‚
â”‚   â”‚   â”‚                                                          â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   BR = 00 (NEXT): Select Î¼AR + 1                        â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   BR = 01 (JUMP): If condition true â†’ AD                â”‚   â”‚ â”‚
â”‚   â”‚   â”‚                   If condition false â†’ Î¼AR + 1          â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   BR = 10 (CALL): Select AD, also push Î¼AR + 1          â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   BR = 11 (RET):  Select SBR (pop from stack)           â”‚   â”‚ â”‚
â”‚   â”‚   â”‚                                                          â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   For MAP: Special case, use external mapping logic     â”‚   â”‚ â”‚
â”‚   â”‚   â”‚                                                          â”‚   â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Condition Testing

### ğŸ“Œ Condition Multiplexer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONDITION SELECT LOGIC                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   CD field selects which condition to test:                             â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚                     Status Flags & Signals                        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Always True â”€â”€â”€â”€â”€â”€â”                                             â”‚ â”‚
â”‚   â”‚   (logic 1)         â”‚                                             â”‚ â”‚
â”‚   â”‚                     â”‚                                             â”‚ â”‚
â”‚   â”‚   AC Sign â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     CD                                      â”‚ â”‚
â”‚   â”‚   (AC[15])          â”‚    â”Œâ”€â”€â”€â”€â”                                   â”‚ â”‚
â”‚   â”‚                     â”œâ”€â”€â”€â–ºâ”‚4:1 â”‚                                   â”‚ â”‚
â”‚   â”‚   AC Zero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚MUX â”‚â”€â”€â”€â–º Condition                     â”‚ â”‚
â”‚   â”‚   (AC = 0)          â”‚    â”‚    â”‚     Result                        â”‚ â”‚
â”‚   â”‚                     â”‚    â””â”€â”€â”€â”€â”˜                                   â”‚ â”‚
â”‚   â”‚   Indirect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â–²                                    â”‚ â”‚
â”‚   â”‚   (IR[15])                   â”‚                                    â”‚ â”‚
â”‚   â”‚                         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                               â”‚ â”‚
â”‚   â”‚                         â”‚   CD    â”‚ (from Î¼IR)                    â”‚ â”‚
â”‚   â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   CD Encoding:                                                    â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚   â”‚ CD  â”‚ Condition Selected                                   â”‚ â”‚ â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚   â”‚   â”‚ 00  â”‚ Always true (1) - unconditional branch              â”‚ â”‚ â”‚
â”‚   â”‚   â”‚ 01  â”‚ AC sign bit - branch if AC < 0                      â”‚ â”‚ â”‚
â”‚   â”‚   â”‚ 10  â”‚ AC zero - branch if AC = 0                          â”‚ â”‚ â”‚
â”‚   â”‚   â”‚ 11  â”‚ Indirect addressing - branch if I = 1               â”‚ â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Extended Condition Select (3-bit CD):                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚   â”‚   â”‚ CD  â”‚ Condition                                          â”‚   â”‚ â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ â”‚
â”‚   â”‚   â”‚ 000 â”‚ Always (unconditional)                             â”‚   â”‚ â”‚
â”‚   â”‚   â”‚ 001 â”‚ Carry flag (C = 1)                                 â”‚   â”‚ â”‚
â”‚   â”‚   â”‚ 010 â”‚ Zero flag (Z = 1)                                  â”‚   â”‚ â”‚
â”‚   â”‚   â”‚ 011 â”‚ Sign/Negative flag (S = 1)                         â”‚   â”‚ â”‚
â”‚   â”‚   â”‚ 100 â”‚ Overflow flag (V = 1)                              â”‚   â”‚ â”‚
â”‚   â”‚   â”‚ 101 â”‚ Indirect bit (I = 1)                               â”‚   â”‚ â”‚
â”‚   â”‚   â”‚ 110 â”‚ Interrupt enable (IEN = 1)                         â”‚   â”‚ â”‚
â”‚   â”‚   â”‚ 111 â”‚ Input ready (FGI = 1)                              â”‚   â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Branch Types

### ğŸ“Œ BR Field Implementation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BRANCH CONTROL FIELD                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   BR field determines branch behavior:                                  â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   BR = 00 (NEXT):                                                â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚   â”‚   Î¼AR â† Î¼AR + 1                                                  â”‚ â”‚
â”‚   â”‚   Always go to next sequential microinstruction                  â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚   â”‚  Before: Î¼AR = 25                                          â”‚ â”‚ â”‚
â”‚   â”‚   â”‚  After:  Î¼AR = 26   (regardless of AD field)               â”‚ â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   BR = 01 (JUMP):                                                â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚   â”‚   if (condition = 1) Î¼AR â† AD                                    â”‚ â”‚
â”‚   â”‚   else Î¼AR â† Î¼AR + 1                                             â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚   â”‚  Î¼IR: | ... | CD=10 | BR=01 | AD=50 |                      â”‚ â”‚ â”‚
â”‚   â”‚   â”‚       Test: AC = 0?                                        â”‚ â”‚ â”‚
â”‚   â”‚   â”‚  If AC = 0: Î¼AR = 50 (jump to address 50)                  â”‚ â”‚ â”‚
â”‚   â”‚   â”‚  If AC â‰  0: Î¼AR = Î¼AR + 1 (continue sequentially)          â”‚ â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   BR = 10 (CALL):                                                â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚   â”‚   SBR â† Î¼AR + 1    (save return address)                        â”‚ â”‚
â”‚   â”‚   Î¼AR â† AD         (jump to subroutine)                         â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚   â”‚  Before: Î¼AR = 30, AD = 100                                â”‚ â”‚ â”‚
â”‚   â”‚   â”‚  After:  SBR = 31, Î¼AR = 100                               â”‚ â”‚ â”‚
â”‚   â”‚   â”‚  (Will return to 31 after subroutine)                      â”‚ â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   BR = 11 (RET / MAP):                                           â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚   â”‚   Option A - Return: Î¼AR â† SBR (return from subroutine)         â”‚ â”‚
â”‚   â”‚   Option B - Map:    Î¼AR â† Map(IR) (dispatch to instruction)    â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚   â”‚  Some designs split these into separate BR codes           â”‚ â”‚ â”‚
â”‚   â”‚   â”‚  BR = 11 + CD = 00: MAP                                    â”‚ â”‚ â”‚
â”‚   â”‚   â”‚  BR = 11 + CD = 01: RET                                    â”‚ â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Microprogram Subroutines

### ğŸ“Œ Subroutine Mechanism

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MICROPROGRAM SUBROUTINES                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Common micro-operations can be shared across microprograms:           â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Example: Indirect addressing subroutine                        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Control Memory Layout:                                         â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚   â”‚   â”‚                                                             â”‚â”‚ â”‚
â”‚   â”‚   â”‚   Î¼Addr â”‚ Microinstruction                                  â”‚â”‚ â”‚
â”‚   â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚â”‚ â”‚
â”‚   â”‚   â”‚     ... â”‚ ...                                               â”‚â”‚ â”‚
â”‚   â”‚   â”‚                                                             â”‚â”‚ â”‚
â”‚   â”‚   â”‚   === ADD Instruction Microprogram ===                      â”‚â”‚ â”‚
â”‚   â”‚   â”‚     32  â”‚ MAR â† IR(addr), Check I                          â”‚â”‚ â”‚
â”‚   â”‚   â”‚     33  â”‚ If I=1: CALL 120 (indirect subroutine)           â”‚â”‚ â”‚
â”‚   â”‚   â”‚     34  â”‚ DR â† M[MAR]                                       â”‚â”‚ â”‚
â”‚   â”‚   â”‚     35  â”‚ AC â† AC + DR, JUMP 0 (fetch)                     â”‚â”‚ â”‚
â”‚   â”‚   â”‚                                                             â”‚â”‚ â”‚
â”‚   â”‚   â”‚   === LOAD Instruction Microprogram ===                     â”‚â”‚ â”‚
â”‚   â”‚   â”‚     48  â”‚ MAR â† IR(addr), Check I                          â”‚â”‚ â”‚
â”‚   â”‚   â”‚     49  â”‚ If I=1: CALL 120 (indirect subroutine)           â”‚â”‚ â”‚
â”‚   â”‚   â”‚     50  â”‚ DR â† M[MAR]                                       â”‚â”‚ â”‚
â”‚   â”‚   â”‚     51  â”‚ AC â† DR, JUMP 0 (fetch)                          â”‚â”‚ â”‚
â”‚   â”‚   â”‚                                                             â”‚â”‚ â”‚
â”‚   â”‚   â”‚   === Indirect Address Subroutine ===                       â”‚â”‚ â”‚
â”‚   â”‚   â”‚    120  â”‚ DR â† M[MAR]    ; read pointer                    â”‚â”‚ â”‚
â”‚   â”‚   â”‚    121  â”‚ MAR â† DR       ; update address                  â”‚â”‚ â”‚
â”‚   â”‚   â”‚    122  â”‚ RET            ; return to caller                â”‚â”‚ â”‚
â”‚   â”‚   â”‚                                                             â”‚â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Benefits:                                                      â”‚ â”‚
â”‚   â”‚   â€¢ Saves control memory space                                  â”‚ â”‚
â”‚   â”‚   â€¢ Common code written once                                    â”‚ â”‚
â”‚   â”‚   â€¢ Easier maintenance                                          â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Œ Subroutine Register (SBR) Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUBROUTINE RETURN MECHANISM                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Simple: Single Register (SBR)                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   CALL operation:                                                â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚   â”‚   â”‚   SBR â† Î¼AR + 1    (save return address)                   â”‚â”‚ â”‚
â”‚   â”‚   â”‚   Î¼AR â† AD         (jump to subroutine)                    â”‚â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   RET operation:                                                 â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚   â”‚   â”‚   Î¼AR â† SBR        (return to saved address)               â”‚â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Limitation: No nested subroutine calls (only 1 level)         â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Advanced: Subroutine Stack                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   For nested subroutine calls, use a stack:                     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚   â”‚                                                           â”‚ â”‚ â”‚
â”‚   â”‚   â”‚    Stack Pointer (SP)                                     â”‚ â”‚ â”‚
â”‚   â”‚   â”‚         â”‚                                                 â”‚ â”‚ â”‚
â”‚   â”‚   â”‚         â–¼                                                 â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚ Return3 â”‚ â† SP after 3rd CALL                        â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                             â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚ Return2 â”‚                                             â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                             â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚ Return1 â”‚                                             â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                             â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚  empty  â”‚                                             â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚ â”‚ â”‚
â”‚   â”‚   â”‚                                                           â”‚ â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   CALL: Push(Î¼AR + 1), Î¼AR â† AD                                 â”‚ â”‚
â”‚   â”‚   RET:  Î¼AR â† Pop()                                             â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Stack depth determines maximum nesting (typically 4-8 levels) â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Mapping Function

### ğŸ“Œ Opcode to Microaddress Mapping

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INSTRUCTION MAPPING                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   After fetch, decode opcode â†’ microprogram start address              â”‚
â”‚                                                                          â”‚
â”‚   Method 1: Direct Mapping                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   IR opcode bits become part of Î¼AR directly:                    â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   IR: â”‚ Opcode â”‚ Address/Operand â”‚                               â”‚ â”‚
â”‚   â”‚       â”‚  4-bit â”‚                 â”‚                               â”‚ â”‚
â”‚   â”‚           â”‚                                                       â”‚ â”‚
â”‚   â”‚           â”‚     Concatenate with fixed bits                      â”‚ â”‚
â”‚   â”‚           â–¼                                                       â”‚ â”‚
â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚ â”‚
â”‚   â”‚       â”‚ 0 â”‚ Opcode â”‚ 0 â”‚ 0 â”‚ 0   â”‚ = 8-bit Î¼AR                  â”‚ â”‚
â”‚   â”‚       â”‚ 1 â”‚  4-bit â”‚ 3 zeros     â”‚                               â”‚ â”‚
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Opcode 0000 â†’ Î¼AR = 0 â”‚ 0000 â”‚ 000 = 00000000 = 0             â”‚ â”‚
â”‚   â”‚   Opcode 0001 â†’ Î¼AR = 0 â”‚ 0001 â”‚ 000 = 00001000 = 8             â”‚ â”‚
â”‚   â”‚   Opcode 0010 â†’ Î¼AR = 0 â”‚ 0010 â”‚ 000 = 00010000 = 16            â”‚ â”‚
â”‚   â”‚   ...                                                             â”‚ â”‚
â”‚   â”‚   Opcode 1111 â†’ Î¼AR = 0 â”‚ 1111 â”‚ 000 = 01111000 = 120           â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Each instruction gets 8 locations (2Â³) for its microprogram   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Method 2: Mapping ROM                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚ â”‚
â”‚   â”‚   IR opcode â”€â–ºâ”‚  Mapping ROM  â”‚â”€â–º Microprogram Address          â”‚ â”‚
â”‚   â”‚               â”‚  (16 Ã— 8 bit) â”‚                                  â”‚ â”‚
â”‚   â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚   â”‚   â”‚ Opcode â”‚ Î¼P Start â”‚ Instruction                          â”‚   â”‚ â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ â”‚
â”‚   â”‚   â”‚  0000  â”‚    64    â”‚ AND                                  â”‚   â”‚ â”‚
â”‚   â”‚   â”‚  0001  â”‚    70    â”‚ ADD                                  â”‚   â”‚ â”‚
â”‚   â”‚   â”‚  0010  â”‚    76    â”‚ LDA                                  â”‚   â”‚ â”‚
â”‚   â”‚   â”‚  0011  â”‚    82    â”‚ STA                                  â”‚   â”‚ â”‚
â”‚   â”‚   â”‚  0100  â”‚    88    â”‚ BUN                                  â”‚   â”‚ â”‚
â”‚   â”‚   â”‚  0101  â”‚    92    â”‚ BSA                                  â”‚   â”‚ â”‚
â”‚   â”‚   â”‚  0110  â”‚    98    â”‚ ISZ                                  â”‚   â”‚ â”‚
â”‚   â”‚   â”‚  0111  â”‚   104    â”‚ (reserved)                           â”‚   â”‚ â”‚
â”‚   â”‚   â”‚  ...   â”‚   ...    â”‚ ...                                  â”‚   â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Flexible: instructions can have different microprogram sizes  â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Complete Sequencing Example

### ğŸ“Œ Execution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPLETE SEQUENCING EXAMPLE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Execute: ADD @X  (Add indirect)                                       â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Microprogram Flow:                                             â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Î¼Addr â”‚ Operation              â”‚ BR  â”‚ CD  â”‚ AD  â”‚ Next Î¼Addr  â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   === FETCH ROUTINE ===                                          â”‚ â”‚
â”‚   â”‚    00   â”‚ MAR â† PC              â”‚ 00  â”‚ --  â”‚ --  â”‚ 01          â”‚ â”‚
â”‚   â”‚    01   â”‚ Read, PC++            â”‚ 00  â”‚ --  â”‚ --  â”‚ 02          â”‚ â”‚
â”‚   â”‚    02   â”‚ IR â† MDR              â”‚ 00  â”‚ --  â”‚ --  â”‚ 03          â”‚ â”‚
â”‚   â”‚    03   â”‚ (Decode)              â”‚ 11  â”‚ --  â”‚ --  â”‚ MAP(IR)     â”‚ â”‚
â”‚   â”‚                                        â–¼                          â”‚ â”‚
â”‚   â”‚                               MAP to ADD = 70                     â”‚ â”‚
â”‚   â”‚                                        â”‚                          â”‚ â”‚
â”‚   â”‚   === ADD MICROPROGRAM ===             â–¼                          â”‚ â”‚
â”‚   â”‚    70   â”‚ MAR â† IR(addr)        â”‚ 00  â”‚ --  â”‚ --  â”‚ 71          â”‚ â”‚
â”‚   â”‚    71   â”‚ (check indirect)       â”‚ 01  â”‚ 11  â”‚ 120 â”‚ 72 or 120   â”‚ â”‚
â”‚   â”‚                                        â”‚                          â”‚ â”‚
â”‚   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚   â”‚         â”‚ I=0: Continue        I=1: CALL indirect routine  â”‚     â”‚ â”‚
â”‚   â”‚         â–¼                                                  â–¼     â”‚ â”‚
â”‚   â”‚    72   â”‚ Read M[MAR]           â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚   â”‚    73   â”‚ DR â† MDR              â”‚                    â”‚  120   â”‚  â”‚ â”‚
â”‚   â”‚    74   â”‚ AC â† AC + DR          â”‚                    â”‚  121   â”‚  â”‚ â”‚
â”‚   â”‚    75   â”‚ (end)                 â”‚ 01 â”‚ 00  â”‚ 00  â”‚   â”‚  122   â”‚  â”‚ â”‚
â”‚   â”‚                                  â”‚    â”‚     â”‚     â”‚   â”‚  RET   â”‚  â”‚ â”‚
â”‚   â”‚                                  â”‚    â”‚     â”‚     â”‚   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚   â”‚                                  â–¼    â”‚     â”‚     â”‚       â”‚       â”‚ â”‚
â”‚   â”‚         Jump back to FETCH      00   (return to 72) â—„â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   === INDIRECT SUBROUTINE ===                                    â”‚ â”‚
â”‚   â”‚    120  â”‚ Read M[MAR]           â”‚ 00  â”‚ --  â”‚ --  â”‚ 121         â”‚ â”‚
â”‚   â”‚    121  â”‚ MAR â† MDR             â”‚ 00  â”‚ --  â”‚ --  â”‚ 122         â”‚ â”‚
â”‚   â”‚    122  â”‚ RET                   â”‚ 11  â”‚ 01  â”‚ --  â”‚ SBR=72      â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Summary Table

| Sequencing Type | BR Code | Action | Use Case |
|-----------------|---------|--------|----------|
| **Sequential** | 00 | Î¼AR â† Î¼AR + 1 | Normal execution |
| **Conditional Jump** | 01 | If cond: Î¼AR â† AD | Decision points |
| **Subroutine Call** | 10 | Push, Î¼AR â† AD | Common routines |
| **Return** | 11 | Î¼AR â† SBR | End of subroutine |
| **Map** | 11 | Î¼AR â† Map(IR) | Instruction dispatch |

| Condition Code | Value | Test |
|---------------|-------|------|
| **CD = 00** | Always | Unconditional |
| **CD = 01** | Sign | AC < 0 |
| **CD = 10** | Zero | AC = 0 |
| **CD = 11** | Indirect | I-bit = 1 |

---

## â“ Quick Revision Questions

1. **Q**: What are the four main sources of the next microaddress?
   
   **A**: (1) Î¼AR + 1 (sequential), (2) Address field from microinstruction (branch), (3) Mapping from IR opcode (dispatch), (4) Subroutine return stack.

2. **Q**: How does conditional branching work in microprogrammed control?
   
   **A**: The CD field selects which condition to test (zero, sign, carry, etc.). If condition is true and BR=01, the microaddress in the AD field is loaded into Î¼AR; otherwise Î¼AR+1 is used.

3. **Q**: What is the purpose of the mapping function after instruction fetch?
   
   **A**: It converts the machine instruction opcode (from IR) into the starting address of the corresponding microprogram, effectively dispatching control to the correct microcode routine.

4. **Q**: Why are microsubroutines useful?
   
   **A**: They allow common microoperations (like indirect address resolution) to be written once and called from multiple instruction microprograms, saving control memory space.

5. **Q**: What limits nesting of microsubroutine calls?
   
   **A**: The depth of the subroutine return stack. Simple designs with a single SBR register allow only one level; designs with a 4-deep stack allow up to 4 nested calls.

6. **Q**: What is the difference between direct mapping and mapping ROM?
   
   **A**: Direct mapping concatenates opcode bits with fixed bits to form the microaddress (fast but wastes space). Mapping ROM is a lookup table that gives flexible microprogram start addresses (allows variable-length microprograms).

---

## ğŸ§­ Navigation

| Previous | Up | Next |
|----------|-----|------|
| [Microinstruction Format](02-microinstruction-format.md) | [Unit 7 Home](README.md) | [Microprogrammed CPU](04-microprogrammed-cpu.md) |

---

[â† Previous Chapter](02-microinstruction-format.md) | [Course Home](../README.md) | [Next Chapter â†’](04-microprogrammed-cpu.md)
