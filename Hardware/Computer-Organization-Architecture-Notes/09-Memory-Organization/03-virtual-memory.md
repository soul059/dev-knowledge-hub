# Chapter 9.3: Virtual Memory

## ğŸ“‹ Chapter Overview

Virtual memory extends the memory hierarchy to include secondary storage, providing the illusion of a very large main memory. This chapter covers address translation, page tables, TLB, and page replacement algorithms.

---

## ğŸ¯ Learning Objectives

- Understand virtual memory concepts and benefits
- Master page table organization and address translation
- Learn TLB operation and hierarchical page tables
- Analyze page replacement algorithms

---

## 1. Virtual Memory Concepts

### ğŸ“Œ Why Virtual Memory?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VIRTUAL MEMORY MOTIVATION                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Problems Without Virtual Memory:                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   1. Limited Memory                                              â”‚ â”‚
â”‚   â”‚      Programs can't use more memory than physically installed   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   2. Fragmentation                                               â”‚ â”‚
â”‚   â”‚      Memory becomes fragmented as programs start/end            â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   3. No Protection                                               â”‚ â”‚
â”‚   â”‚      Programs can access any memory (crash other programs!)     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   4. Fixed Addresses                                             â”‚ â”‚
â”‚   â”‚      Programs must know their memory location at compile time   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   5. Multi-programming Difficulty                                â”‚ â”‚
â”‚   â”‚      Hard to run multiple programs simultaneously               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Virtual Memory Solution:                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚ â”‚
â”‚   â”‚   â”‚   Process 1     â”‚        â”‚   Physical      â”‚                 â”‚ â”‚
â”‚   â”‚   â”‚   Virtual       â”‚        â”‚   Memory        â”‚                 â”‚ â”‚
â”‚   â”‚   â”‚   Address Space â”‚        â”‚   (4 GB)        â”‚                 â”‚ â”‚
â”‚   â”‚   â”‚   (4 GB)        â”‚â”€â”€â”€â”    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                 â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚  â”‚ P1 page â”‚   â”‚                 â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚                 â”‚ â”‚
â”‚   â”‚   â”‚   Process 2     â”‚   â”œâ”€â”€â”€â–ºâ”‚  â”‚ P2 page â”‚   â”‚                 â”‚ â”‚
â”‚   â”‚   â”‚   Virtual       â”‚   â”‚    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚                 â”‚ â”‚
â”‚   â”‚   â”‚   Address Space â”‚â”€â”€â”€â”˜    â”‚  â”‚ P1 page â”‚   â”‚                 â”‚ â”‚
â”‚   â”‚   â”‚   (4 GB)        â”‚        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚                 â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚  Free   â”‚   â”‚                 â”‚ â”‚
â”‚   â”‚                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                 â”‚ â”‚
â”‚   â”‚   Each process thinks        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚
â”‚   â”‚   it has full 4 GB!          Mapped to shared                   â”‚ â”‚
â”‚   â”‚                              physical memory                     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Benefits:                                                             â”‚
â”‚   âœ“ Large address space (exceeds physical memory)                     â”‚
â”‚   âœ“ Memory protection (each process isolated)                         â”‚
â”‚   âœ“ Memory sharing (libraries shared between processes)              â”‚
â”‚   âœ“ Simplified linking/loading (fixed virtual addresses)             â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Œ Pages and Frames

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PAGES AND FRAMES                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Terminology:                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Page: Fixed-size block of VIRTUAL memory                       â”‚ â”‚
â”‚   â”‚   Frame: Fixed-size block of PHYSICAL memory                     â”‚ â”‚
â”‚   â”‚   Page size = Frame size (typically 4 KB)                       â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Page Table: Maps virtual pages â†’ physical frames              â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Address Translation:                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Virtual Address (32-bit, 4KB pages):                          â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚   â”‚   â”‚   Virtual Page Number  â”‚        Page Offset             â”‚     â”‚ â”‚
â”‚   â”‚   â”‚       (20 bits)        â”‚         (12 bits)              â”‚     â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚   â”‚            â”‚                            â”‚                         â”‚ â”‚
â”‚   â”‚            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                         â”‚ â”‚
â”‚   â”‚            â””â”€â”€â–ºâ”‚   Page Table     â”‚     â”‚                         â”‚ â”‚
â”‚   â”‚                â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚     â”‚                         â”‚ â”‚
â”‚   â”‚                â”‚  â”‚ VPN â”‚ PPN    â”‚â”‚     â”‚                         â”‚ â”‚
â”‚   â”‚                â”‚  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚     â”‚                         â”‚ â”‚
â”‚   â”‚                â”‚  â”‚  0  â”‚ Frame 5â”‚â”‚     â”‚                         â”‚ â”‚
â”‚   â”‚                â”‚  â”‚  1  â”‚ Frame 2â”‚â”‚     â”‚                         â”‚ â”‚
â”‚   â”‚                â”‚  â”‚  2  â”‚ (disk) â”‚â”‚     â”‚                         â”‚ â”‚
â”‚   â”‚                â”‚  â”‚ ... â”‚  ...   â”‚â”‚     â”‚                         â”‚ â”‚
â”‚   â”‚                â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚     â”‚                         â”‚ â”‚
â”‚   â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”˜     â”‚                         â”‚ â”‚
â”‚   â”‚                             â”‚           â”‚                         â”‚ â”‚
â”‚   â”‚                             â–¼           â–¼                         â”‚ â”‚
â”‚   â”‚   Physical Address:                                              â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚   â”‚   â”‚ Physical Frame Number â”‚        Page Offset             â”‚      â”‚ â”‚
â”‚   â”‚   â”‚     (from table)      â”‚       (unchanged)              â”‚      â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Offset passes through unchanged (same position in page/frame) â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Page Table Structure

### ğŸ“Œ Page Table Entry (PTE)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PAGE TABLE ENTRY                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Typical 32-bit PTE (4KB pages):                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   31                              12 11    9 8 7 6 5 4 3 2 1 0   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”     â”‚ â”‚
â”‚   â”‚   â”‚   Physical Frame Number      â”‚  â”‚  â”‚Gâ”‚ â”‚Dâ”‚Aâ”‚ â”‚ â”‚Uâ”‚Wâ”‚Pâ”‚     â”‚ â”‚
â”‚   â”‚   â”‚        (20 bits)             â”‚  â”‚  â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚/â”‚/â”‚ â”‚     â”‚ â”‚
â”‚   â”‚   â”‚                              â”‚  â”‚  â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚Sâ”‚Râ”‚ â”‚     â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”˜     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Bit fields:                                                    â”‚ â”‚
â”‚   â”‚   P (Present)  : 1 = in memory, 0 = on disk (page fault)       â”‚ â”‚
â”‚   â”‚   W/R (Write)  : 1 = read/write, 0 = read-only                  â”‚ â”‚
â”‚   â”‚   U/S (User)   : 1 = user accessible, 0 = kernel only          â”‚ â”‚
â”‚   â”‚   A (Accessed) : Set by hardware on any access                  â”‚ â”‚
â”‚   â”‚   D (Dirty)    : Set by hardware on write                       â”‚ â”‚
â”‚   â”‚   G (Global)   : Don't flush from TLB on context switch         â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Page Table in Memory:                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   PTBR (Page Table Base Register)                               â”‚ â”‚
â”‚   â”‚     â”‚                                                            â”‚ â”‚
â”‚   â”‚     â–¼                                                            â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚   â”‚   â”‚ VPN 0 â”‚ Pâ”‚Wâ”‚Uâ”‚Aâ”‚Dâ”‚       Physical Frame Number             â”‚â”‚ â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚
â”‚   â”‚   â”‚ VPN 1 â”‚ 1â”‚1 â”‚1 â”‚1 â”‚0 â”‚             Frame 42                â”‚â”‚ â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚
â”‚   â”‚   â”‚ VPN 2 â”‚ 0â”‚- â”‚- â”‚- â”‚- â”‚          (on disk)                  â”‚â”‚ â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚
â”‚   â”‚   â”‚ VPN 3 â”‚ 1â”‚0 â”‚1 â”‚1 â”‚1 â”‚             Frame 17                â”‚â”‚ â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚
â”‚   â”‚   â”‚  ...  â”‚  â”‚  â”‚  â”‚  â”‚             ...                        â”‚â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Table size for 32-bit virtual, 4KB pages:                     â”‚ â”‚
â”‚   â”‚   2Â²â° entries Ã— 4 bytes = 4 MB per process!                    â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Hierarchical Page Tables

### ğŸ“Œ Multi-Level Page Tables

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TWO-LEVEL PAGE TABLE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Problem: Single-level page table is too large                        â”‚
â”‚   Solution: Use hierarchy (only allocate pages actually used)          â”‚
â”‚                                                                          â”‚
â”‚   32-bit Address with Two-Level Paging:                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   31            22 21          12 11                0            â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚   â”‚   â”‚   L1 Index   â”‚   L2 Index   â”‚    Page Offset      â”‚          â”‚ â”‚
â”‚   â”‚   â”‚  (10 bits)   â”‚  (10 bits)   â”‚     (12 bits)       â”‚          â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚   â”‚          â”‚              â”‚                                         â”‚ â”‚
â”‚   â”‚          â”‚              â”‚                                         â”‚ â”‚
â”‚   â”‚          â–¼              â”‚                                         â”‚ â”‚
â”‚   â”‚   Page Directory        â”‚                                         â”‚ â”‚
â”‚   â”‚   (Level 1)             â”‚                                         â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                                         â”‚ â”‚
â”‚   â”‚   â”‚ Entry 0    â”‚        â”‚                                         â”‚ â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚                                         â”‚ â”‚
â”‚   â”‚   â”‚ Entry 1 â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”                                    â”‚ â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚   â”‚                                    â”‚ â”‚
â”‚   â”‚   â”‚   NULL     â”‚        â”‚   â”‚                                    â”‚ â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚   â”‚                                    â”‚ â”‚
â”‚   â”‚   â”‚ Entry 3    â”‚        â”‚   â”‚                                    â”‚ â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚   â”‚  Page Table                        â”‚ â”‚
â”‚   â”‚   â”‚    ...     â”‚        â”‚   â”‚  (Level 2)                         â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â–¼                                    â”‚ â”‚
â”‚   â”‚                         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚ â”‚
â”‚   â”‚                         â”‚ â”‚ Entry 0    â”‚                          â”‚ â”‚
â”‚   â”‚                         â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚ â”‚
â”‚   â”‚                         â””â–ºâ”‚ Entry 1â”€â”€â”€â”€â”¼â”€â”€â”€â–º Physical Frame      â”‚ â”‚
â”‚   â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚ â”‚
â”‚   â”‚                           â”‚ Entry 2    â”‚                          â”‚ â”‚
â”‚   â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚ â”‚
â”‚   â”‚                           â”‚    ...     â”‚                          â”‚ â”‚
â”‚   â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Memory Savings:                                                â”‚ â”‚
â”‚   â”‚   â€¢ Page directory: 1024 Ã— 4B = 4 KB (always present)           â”‚ â”‚
â”‚   â”‚   â€¢ Each L2 table: 1024 Ã— 4B = 4 KB (only if needed)           â”‚ â”‚
â”‚   â”‚   â€¢ Sparse address space â†’ most L2 tables not allocated!       â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Œ 64-bit Address Space

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FOUR-LEVEL PAGE TABLE (x86-64)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   64-bit virtual address (only 48 bits used currently):                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   63   48 47   39 38   30 29   21 20   12 11        0           â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚   â”‚   â”‚Sign â”‚ PML4   â”‚ PDPT   â”‚  PD    â”‚  PT    â”‚ Offset  â”‚          â”‚ â”‚
â”‚   â”‚   â”‚Ext  â”‚(9 bits)â”‚(9 bits)â”‚(9 bits)â”‚(9 bits)â”‚(12 bits)â”‚          â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   4 levels Ã— 9 bits = 36 bits â†’ 2Â³â¶ pages Ã— 4KB = 256 TB        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Translation Walk:                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   CR3 (Page Map Level 4 Pointer)                                â”‚ â”‚
â”‚   â”‚     â”‚                                                            â”‚ â”‚
â”‚   â”‚     â–¼                                                            â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚   â”‚   â”‚ PML4  â”‚ â”€â”€â”€â”€â–ºâ”‚ PDPT  â”‚ â”€â”€â”€â”€â–ºâ”‚  PD   â”‚ â”€â”€â”€â”€â–ºâ”‚  PT   â”‚        â”‚ â”‚
â”‚   â”‚   â”‚ Table â”‚      â”‚ Table â”‚      â”‚ Table â”‚      â”‚ Table â”‚        â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚   â”‚      â†‘              â†‘              â†‘              â†‘              â”‚ â”‚
â”‚   â”‚   PML4 idx       PDPT idx        PD idx         PT idx           â”‚ â”‚
â”‚   â”‚                                                   â”‚              â”‚ â”‚
â”‚   â”‚                                                   â–¼              â”‚ â”‚
â”‚   â”‚                                            Physical Frame        â”‚ â”‚
â”‚   â”‚                                                   +              â”‚ â”‚
â”‚   â”‚                                               Offset             â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   4 memory accesses just for translation!                       â”‚ â”‚
â”‚   â”‚   â†’ TLB is critical for performance                             â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Translation Lookaside Buffer (TLB)

### ğŸ“Œ TLB Structure and Operation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TRANSLATION LOOKASIDE BUFFER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   TLB = Cache for page table entries                                   â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚                Virtual Address                                    â”‚ â”‚
â”‚   â”‚                     â”‚                                             â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚ â”‚
â”‚   â”‚   â”‚                    â”‚                         â”‚                â”‚ â”‚
â”‚   â”‚   â–¼                    â–¼                         â”‚                â”‚ â”‚
â”‚   â”‚   VPN              Page Offset                   â”‚                â”‚ â”‚
â”‚   â”‚   â”‚                    â”‚                         â”‚                â”‚ â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚   â”‚   â”‚  â”‚      TLB        â”‚                         â”‚     â”‚         â”‚ â”‚
â”‚   â”‚   â”‚  â”‚   (Fully        â”‚                         â”‚     â”‚         â”‚ â”‚
â”‚   â”‚   â”‚  â”‚  Associative)   â”‚                         â”‚     â”‚         â”‚ â”‚
â”‚   â”‚   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚     â”‚         â”‚ â”‚
â”‚   â”‚   â”‚  â”‚ â”‚ Vâ”‚ASIDâ”‚  VPN  â”‚  PPN  â”‚ Prot bits    â”‚â”‚     â”‚         â”‚ â”‚
â”‚   â”‚   â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚     â”‚         â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”¼â–ºâ”‚ 1â”‚ 5  â”‚ 0x1A2 â”‚ 0x42  â”‚ R/W/U        â”‚â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚ â”‚ 1â”‚ 3  â”‚ 0x3B1 â”‚ 0x17  â”‚ R/-/U        â”‚â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚ â”‚ 0â”‚ - â”‚  -    â”‚  -    â”‚  -           â”‚â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚ â”‚  ...  â”‚       â”‚       â”‚              â”‚â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚             â”‚                            â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚             â”‚ TLB Hit                    â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚             â”‚                            â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚             â–¼                            â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚            PPN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚     â”‚         â”‚ â”‚
â”‚   â”‚                                            â”‚ â”‚  â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      Physical Address                      â”‚ â”‚  â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚     â”‚         â”‚ â”‚
â”‚   â”‚      â”‚       PPN        â”‚    Page Offset     â”‚â—„â”€â”˜     â”‚         â”‚ â”‚
â”‚   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚         â”‚ â”‚
â”‚   â”‚                                                       â”‚         â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   TLB Miss: Walk page table, load entry into TLB                       â”‚
â”‚                                                                          â”‚
â”‚   ASID (Address Space ID): Identifies process (avoids TLB flush        â”‚
â”‚   on context switch)                                                    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Œ TLB Performance

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TLB PERFORMANCE ANALYSIS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Typical TLB Parameters:                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   L1 DTLB: 64 entries, 4-way, 1 cycle hit                       â”‚ â”‚
â”‚   â”‚   L1 ITLB: 128 entries, 4-way, 1 cycle hit                      â”‚ â”‚
â”‚   â”‚   L2 TLB:  1536 entries, 12-way, ~7 cycles hit                  â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   TLB Miss Penalty: 10-100 cycles (page table walk)             â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Effective Memory Access Time:                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   EMAT = TLB_hit_rate Ã— (TLB_time + Mem_time) +                 â”‚ â”‚
â”‚   â”‚          TLB_miss_rate Ã— (TLB_time + PT_walk + Mem_time)        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Example:                                                        â”‚ â”‚
â”‚   â”‚   TLB hit rate = 99%                                            â”‚ â”‚
â”‚   â”‚   TLB access = 1 ns                                             â”‚ â”‚
â”‚   â”‚   Memory access = 50 ns                                         â”‚ â”‚
â”‚   â”‚   Page table walk = 100 ns (4 memory accesses Ã— 25 ns each)    â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   EMAT = 0.99 Ã— (1 + 50) + 0.01 Ã— (1 + 100 + 50)               â”‚ â”‚
â”‚   â”‚        = 0.99 Ã— 51 + 0.01 Ã— 151                                 â”‚ â”‚
â”‚   â”‚        = 50.49 + 1.51                                           â”‚ â”‚
â”‚   â”‚        = 52 ns                                                   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Only 4% overhead from address translation!                    â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   TLB Coverage:                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Coverage = TLB entries Ã— Page size                            â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   64 entries Ã— 4 KB = 256 KB                                    â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   If working set > 256 KB â†’ TLB thrashing                       â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Solution: Large pages (2 MB, 1 GB)                            â”‚ â”‚
â”‚   â”‚   64 entries Ã— 2 MB = 128 MB coverage!                          â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Page Faults and Replacement

### ğŸ“Œ Page Fault Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PAGE FAULT HANDLING                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Page Fault: Access to page not in physical memory (Present=0)        â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Page Fault Handling Steps:                                     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   1. CPU detects Present=0, raises page fault exception         â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   2. Save CPU state (PC, registers)                             â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   3. OS page fault handler:                                     â”‚ â”‚
â”‚   â”‚      a. Find page on disk (swap space)                          â”‚ â”‚
â”‚   â”‚      b. Find free physical frame                                â”‚ â”‚
â”‚   â”‚         - If none free, select victim page to evict             â”‚ â”‚
â”‚   â”‚         - If victim dirty, write to disk first                  â”‚ â”‚
â”‚   â”‚      c. Read page from disk to frame                            â”‚ â”‚
â”‚   â”‚      d. Update page table (PPN, Present=1)                      â”‚ â”‚
â”‚   â”‚      e. Flush TLB entry for this page                           â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   4. Restart faulting instruction                               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Page Fault Types:                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   1. Minor (Soft) Page Fault                                    â”‚ â”‚
â”‚   â”‚      Page is in memory but page table not set up               â”‚ â”‚
â”‚   â”‚      (e.g., copy-on-write, demand zero)                        â”‚ â”‚
â”‚   â”‚      Cost: ~10-100 Î¼s                                           â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   2. Major (Hard) Page Fault                                    â”‚ â”‚
â”‚   â”‚      Page must be loaded from disk                              â”‚ â”‚
â”‚   â”‚      Cost: ~5-20 ms (SSD) or ~10-50 ms (HDD)                   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   3. Invalid Page Fault                                         â”‚ â”‚
â”‚   â”‚      Access to non-existent address (segmentation fault)       â”‚ â”‚
â”‚   â”‚      Program terminated!                                        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Œ Page Replacement Algorithms

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PAGE REPLACEMENT ALGORITHMS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   FIFO (First In First Out):                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Replace the oldest page (first loaded)                        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Reference: 1 2 3 4 1 2 5 1 2 3 4 5 (3 frames)                â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   1: [1|-|-]  2: [1|2|-]  3: [1|2|3]  4: [4|2|3]               â”‚ â”‚
â”‚   â”‚   1: [4|1|3]  2: [4|1|2]  5: [5|1|2]  1: [5|1|2]               â”‚ â”‚
â”‚   â”‚   2: [5|1|2]  3: [5|3|2]  4: [5|3|4]  5: [5|3|4]               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Page faults: 9                                                â”‚ â”‚
â”‚   â”‚   Problem: May evict frequently used page                       â”‚ â”‚
â”‚   â”‚   Belady's Anomaly: More frames can cause MORE faults!         â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   LRU (Least Recently Used):                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Replace the page not used for longest time                    â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Reference: 1 2 3 4 1 2 5 1 2 3 4 5 (3 frames)                â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   1: [1|-|-]  2: [1|2|-]  3: [1|2|3]  4: [4|2|3]               â”‚ â”‚
â”‚   â”‚   1: [4|1|3]  2: [4|1|2]  5: [5|1|2]  1: [5|1|2]               â”‚ â”‚
â”‚   â”‚   2: [5|1|2]  3: [5|3|2]  4: [4|3|2]  5: [4|3|5]               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Page faults: 10                                               â”‚ â”‚
â”‚   â”‚   Note: More faults here but generally better                  â”‚ â”‚
â”‚   â”‚   Implementation: Timestamp or stack-based                      â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Clock (Second Chance):                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Approximates LRU using reference bit                          â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚        â”Œâ”€â”€â”€â”                                                     â”‚ â”‚
â”‚   â”‚        â”‚ P1â”‚ R=1                                                 â”‚ â”‚
â”‚   â”‚        â””â”€â”¬â”€â”˜                                                     â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                                â”‚ â”‚
â”‚   â”‚   â”‚ P4â”‚     â”‚ P2â”‚ R=0  â† Clock hand                             â”‚ â”‚
â”‚   â”‚   â”‚R=1â”‚     â”‚   â”‚                                                â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚ â”‚
â”‚   â”‚        â”‚ P3â”‚ R=1                                                 â”‚ â”‚
â”‚   â”‚        â””â”€â”€â”€â”˜                                                     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Algorithm:                                                    â”‚ â”‚
â”‚   â”‚   1. If R=0: Replace this page                                 â”‚ â”‚
â”‚   â”‚   2. If R=1: Set R=0, advance hand, repeat                     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Pages get a "second chance" if recently used                 â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   OPT (Optimal - Theoretical):                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Replace page that won't be used for longest time              â”‚ â”‚
â”‚   â”‚   Requires future knowledge - impossible to implement!          â”‚ â”‚
â”‚   â”‚   Used as benchmark for comparison                              â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Reference: 1 2 3 4 1 2 5 1 2 3 4 5 (3 frames)                â”‚ â”‚
â”‚   â”‚   Page faults: 7 (best possible)                               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Integration: TLB and Cache

### ğŸ“Œ Virtually vs Physically Indexed Caches

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TLB AND CACHE INTERACTION                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Physically Indexed, Physically Tagged (PIPT):                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   VA â”€â”€â”€â–º TLB â”€â”€â”€â–º PA â”€â”€â”€â–º Cache â”€â”€â”€â–º Data                      â”‚ â”‚
â”‚   â”‚            â”‚                  â”‚                                   â”‚ â”‚
â”‚   â”‚         Translate          Lookup                                â”‚ â”‚
â”‚   â”‚           first             second                               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Pros: No aliasing problems, simple                            â”‚ â”‚
â”‚   â”‚   Cons: Translation on critical path (slow)                     â”‚ â”‚
â”‚   â”‚   Used: L2/L3 caches                                            â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Virtually Indexed, Physically Tagged (VIPT):                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚ â”‚
â”‚   â”‚   VA â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                              â”‚ â”‚
â”‚   â”‚     â”‚        â”‚  TLB (parallel)     â”‚                              â”‚ â”‚
â”‚   â”‚     â”‚        â”‚         â”‚           â”‚                              â”‚ â”‚
â”‚   â”‚     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚ â”‚
â”‚   â”‚     â”‚                  â”‚ PPN                                      â”‚ â”‚
â”‚   â”‚     â–¼                  â–¼                                          â”‚ â”‚
â”‚   â”‚   Cache Index    Tag Compare â”€â”€â”€â–º Hit/Miss                       â”‚ â”‚
â”‚   â”‚   (from VA)      (PA tag vs                                      â”‚ â”‚
â”‚   â”‚                   cache tag)                                     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Parallel access: TLB lookup || Cache index                    â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Constraint: Index bits must come from page offset             â”‚ â”‚
â”‚   â”‚   (same in VA and PA)                                           â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Cache size â‰¤ Associativity Ã— Page size                       â”‚ â”‚
â”‚   â”‚   32KB â‰¤ 8-way Ã— 4KB = 32KB âœ“                                  â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Used: L1 caches (speed critical)                              â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Summary Table

| Concept | Description |
|---------|-------------|
| Page | Fixed-size block of virtual memory (typically 4 KB) |
| Frame | Fixed-size block of physical memory |
| Page Table | Maps virtual pages to physical frames |
| TLB | Cache for page table entries |
| Page Fault | Access to page not in memory |
| Working Set | Pages actively used by process |

| Replacement | Description | Belady's Anomaly? |
|-------------|-------------|-------------------|
| FIFO | Replace oldest | Yes |
| LRU | Replace least recently used | No |
| Clock | Approximate LRU with reference bit | No |
| OPT | Replace page used farthest in future | No (theoretical) |

| Page Table Type | Levels | Used For |
|-----------------|--------|----------|
| Single-Level | 1 | Small address spaces |
| Two-Level | 2 | 32-bit systems |
| Four-Level | 4 | 64-bit systems (x86-64) |

---

## â“ Quick Revision Questions

1. **Q**: Why is virtual memory beneficial?
   
   **A**: It provides: (1) large address space exceeding physical memory, (2) memory protection between processes, (3) simplified linking with fixed virtual addresses, (4) memory sharing between processes.

2. **Q**: What is stored in a page table entry?
   
   **A**: Physical frame number, Present bit (in memory?), Read/Write permission, User/Supervisor access, Accessed bit, Dirty bit, and other protection flags.

3. **Q**: Why use hierarchical page tables?
   
   **A**: A single-level page table for 32-bit addresses needs 4 MB per process. Hierarchical tables only allocate page table pages for address ranges actually used, saving memory.

4. **Q**: What is a TLB and why is it critical?
   
   **A**: TLB (Translation Lookaside Buffer) caches recent page table entries. Without TLB, every memory access would need 4+ memory accesses for page table walk (400+ cycles).

5. **Q**: What happens during a page fault?
   
   **A**: CPU traps to OS, which finds the page on disk, selects a victim frame (evicting if needed), loads the page from disk, updates page table, and restarts the instruction.

6. **Q**: How does the Clock algorithm work?
   
   **A**: Pages arranged in circular list with reference bits. Clock hand advances; if R=0, evict; if R=1, clear R and advance. Pages get a "second chance" if recently accessed.

---

## ğŸ§­ Navigation

| Previous | Up | Next |
|----------|-----|------|
| [Cache Memory](02-cache-memory.md) | [Unit 9 Home](README.md) | [Associative Memory](04-associative-memory.md) |

---

[â† Previous Chapter](02-cache-memory.md) | [Course Home](../README.md) | [Next Chapter â†’](04-associative-memory.md)
