# Chapter 8.4: Branch Handling

## ğŸ“‹ Chapter Overview

Control hazards from branch instructions cause significant performance loss in pipelined processors. This chapter covers branch handling techniques including early branch resolution, delayed branches, and branch prediction to minimize the penalty of branching.

---

## ğŸ¯ Learning Objectives

- Understand the impact of branches on pipeline performance
- Learn early branch resolution techniques
- Design branch prediction mechanisms
- Analyze branch target buffers and return address stacks

---

## 1. Branch Problem Revisited

### ğŸ“Œ Why Branches Are Costly

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    THE BRANCH PROBLEM                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Standard 5-Stage Pipeline Branch Timeline:                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   BEQ R1, R2, target    ; Branch if R1 == R2                     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Cycle:    1    2    3    4    5                                â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   BEQ:      IF   ID   EX   MEM  WB                               â”‚ â”‚
â”‚   â”‚                   â†“    â†“                                          â”‚ â”‚
â”‚   â”‚               Decode Compare                                      â”‚ â”‚
â”‚   â”‚               regs   result                                       â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Without special handling:                                      â”‚ â”‚
â”‚   â”‚   â€¢ Branch target known after: EX (add PC + offset)              â”‚ â”‚
â”‚   â”‚   â€¢ Branch decision known after: EX (ALU compare)                â”‚ â”‚
â”‚   â”‚   â€¢ 2 instructions already fetched (wrong path)!                 â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   I+1:           IF   ID   EX   â† May need to flush              â”‚ â”‚
â”‚   â”‚   I+2:                IF   ID   â† May need to flush              â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Branch Penalty = 2 cycles (if branch is taken)                â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Impact on Performance:                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Branches = ~15-25% of instructions                            â”‚ â”‚
â”‚   â”‚   ~60-70% of branches are taken                                 â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Without handling (2-cycle penalty):                           â”‚ â”‚
â”‚   â”‚   Effective CPI = 1 + (0.20 Ã— 0.65 Ã— 2) = 1.26                  â”‚ â”‚
â”‚   â”‚                      â†‘     â†‘     â†‘                               â”‚ â”‚
â”‚   â”‚                   branch taken penalty                           â”‚ â”‚
â”‚   â”‚                   freq   rate                                    â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   26% performance loss from branches alone!                     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Reducing Branch Penalty

### ğŸ“Œ Early Branch Resolution

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MOVE BRANCH DECISION EARLIER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Key Idea: Resolve branch in ID stage instead of EX stage             â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Add to ID stage:                                               â”‚ â”‚
â”‚   â”‚   1. Comparator for equality (beq/bne)                          â”‚ â”‚
â”‚   â”‚   2. Adder for branch target calculation                        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Standard Branch:                                               â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚ â”‚
â”‚   â”‚   â”‚                                              â”‚               â”‚ â”‚
â”‚   â”‚   â”‚   IF â”€â”€â”€â–º ID â”€â”€â”€â–º EX â”€â”€â”€â–º MEM â”€â”€â”€â–º WB       â”‚               â”‚ â”‚
â”‚   â”‚   â”‚          decode   compare                    â”‚               â”‚ â”‚
â”‚   â”‚   â”‚                   + target                   â”‚               â”‚ â”‚
â”‚   â”‚   â”‚                      â”‚                       â”‚               â”‚ â”‚
â”‚   â”‚   â”‚                   Decision                   â”‚               â”‚ â”‚
â”‚   â”‚   â”‚                   (2 cycles)                 â”‚               â”‚ â”‚
â”‚   â”‚   â”‚                                              â”‚               â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Early Branch Resolution:                                       â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚ â”‚
â”‚   â”‚   â”‚                                              â”‚               â”‚ â”‚
â”‚   â”‚   â”‚   IF â”€â”€â”€â–º ID â”€â”€â”€â–º EX â”€â”€â”€â–º MEM â”€â”€â”€â–º WB       â”‚               â”‚ â”‚
â”‚   â”‚   â”‚          compare                             â”‚               â”‚ â”‚
â”‚   â”‚   â”‚          + target                            â”‚               â”‚ â”‚
â”‚   â”‚   â”‚             â”‚                                â”‚               â”‚ â”‚
â”‚   â”‚   â”‚          Decision                            â”‚               â”‚ â”‚
â”‚   â”‚   â”‚          (1 cycle)                           â”‚               â”‚ â”‚
â”‚   â”‚   â”‚                                              â”‚               â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Hardware Addition for ID-Stage Branch:                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚ â”‚
â”‚   â”‚   Rs â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚         â”‚                                         â”‚ â”‚
â”‚   â”‚              â”‚   =?    â”œâ”€â”€â”€â–º Branch Taken                        â”‚ â”‚
â”‚   â”‚   Rt â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚         â”‚                                         â”‚ â”‚
â”‚   â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚ â”‚
â”‚   â”‚   PC â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚         â”‚                                         â”‚ â”‚
â”‚   â”‚              â”‚  Adder  â”œâ”€â”€â”€â–º Branch Target                       â”‚ â”‚
â”‚   â”‚   Offset â”€â”€â”€â–ºâ”‚         â”‚                                         â”‚ â”‚
â”‚   â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Branch Penalty reduced from 2 cycles to 1 cycle               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Branch Handling Strategies

### ğŸ“Œ Comparison of Approaches

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BRANCH HANDLING STRATEGIES                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Strategy 1: Stall (Freeze Pipeline)                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Cycle:    1    2    3    4    5    6    7                      â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   BEQ:      IF   ID   EX   MEM  WB                               â”‚ â”‚
â”‚   â”‚                  stall stall                                      â”‚ â”‚
â”‚   â”‚   Target:                  IF   ID   EX   MEM  WB                â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Wait until decision is known, then fetch                       â”‚ â”‚
â”‚   â”‚   Penalty: Always 2 cycles (simple) or 1 cycle (early)           â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Strategy 2: Predict Not Taken                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Always fetch sequential instruction (assume branch not taken)  â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   If branch not taken:                                          â”‚ â”‚
â”‚   â”‚   BEQ:      IF   ID   EX   MEM  WB                               â”‚ â”‚
â”‚   â”‚   I+1:           IF   ID   EX   MEM  WB    â† Correct!            â”‚ â”‚
â”‚   â”‚   Penalty: 0 cycles                                              â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   If branch taken:                                              â”‚ â”‚
â”‚   â”‚   BEQ:      IF   ID   EX   MEM  WB                               â”‚ â”‚
â”‚   â”‚   I+1:           IF   ID   ---  ---  ---   â† Flush (1 instr)     â”‚ â”‚
â”‚   â”‚   Target:             IF   ID   EX   MEM  WB                     â”‚ â”‚
â”‚   â”‚   Penalty: 1 cycle (with early resolution)                      â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Strategy 3: Predict Taken                                             â”‚ â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Assume branch is taken                                        â”‚ â”‚
â”‚   â”‚   Problem: Target address not known until ID stage!             â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Must still wait for target calculation                        â”‚ â”‚
â”‚   â”‚   Not useful for forward branches (target calculation latency)  â”‚ â”‚
â”‚   â”‚   Better for backward branches (loops) with known target        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Strategy 4: Delayed Branch                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Define 1 delay slot after branch (always executed)            â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   BEQ R1, R2, target                                            â”‚ â”‚
â”‚   â”‚   ADD R5, R6, R7    ; Delay slot - always executed!             â”‚ â”‚
â”‚   â”‚   ...                                                            â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Cycle:    1    2    3    4    5    6                          â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   BEQ:      IF   ID   EX   MEM  WB                               â”‚ â”‚
â”‚   â”‚   ADD:           IF   ID   EX   MEM  WB  â† Useful work!         â”‚ â”‚
â”‚   â”‚   Target:             IF   ID   EX   MEM  WB                     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Compiler must fill delay slot with useful instruction        â”‚ â”‚
â”‚   â”‚   If no useful instruction: NOP (wastes the slot)              â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Œ Filling the Delay Slot

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DELAY SLOT FILLING STRATEGIES                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Option 1: From Before Branch                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Before:               After:                                   â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”€â”€â”€â”€â”€â”€                                   â”‚ â”‚
â”‚   â”‚   ADD R1, R2, R3        BEQ R4, R0, target                      â”‚ â”‚
â”‚   â”‚   BEQ R4, R0, target    ADD R1, R2, R3    ; Delay slot          â”‚ â”‚
â”‚   â”‚   ...                   ...                                      â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Requirement: ADD must not affect branch condition             â”‚ â”‚
â”‚   â”‚   Effectiveness: Best option, ~50% fillable                     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Option 2: From Branch Target (taken path)                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Before:                  After:                                â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€                                â”‚ â”‚
â”‚   â”‚   BEQ R1, R2, target       BEQ R1, R2, target+4                 â”‚ â”‚
â”‚   â”‚   ...                      SUB R5, R6, R7   ; Delay slot        â”‚ â”‚
â”‚   â”‚   target:                  ...                                   â”‚ â”‚
â”‚   â”‚   SUB R5, R6, R7           target:                              â”‚ â”‚
â”‚   â”‚   ...                      SUB R5, R6, R7   ; Duplicated!       â”‚ â”‚
â”‚   â”‚                            ...                                   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Best when: Branch usually taken                               â”‚ â”‚
â”‚   â”‚   Note: Code duplication (SUB appears twice)                    â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Option 3: From Fall-Through (not taken path)                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Before:                  After:                                â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€                                â”‚ â”‚
â”‚   â”‚   BEQ R1, R2, target       BEQ R1, R2, target                   â”‚ â”‚
â”‚   â”‚   OR  R8, R9, R10          OR  R8, R9, R10   ; Delay slot       â”‚ â”‚
â”‚   â”‚   ...                      ...                                   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Best when: Branch usually not taken                           â”‚ â”‚
â”‚   â”‚   Note: May need to "un-do" if branch taken                     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Delay Slot Utilization:                                               â”‚
â”‚   â€¢ MIPS: ~70% of delay slots filled with useful instructions         â”‚
â”‚   â€¢ Remaining 30% filled with NOPs                                     â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Dynamic Branch Prediction

### ğŸ“Œ Branch Prediction Basics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DYNAMIC BRANCH PREDICTION                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Key Idea: Learn from branch history to predict future behavior        â”‚
â”‚                                                                          â”‚
â”‚   Observation:                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Loop example:                                                  â”‚ â”‚
â”‚   â”‚   loop:                                                          â”‚ â”‚
â”‚   â”‚       ...                                                        â”‚ â”‚
â”‚   â”‚       SUB R1, R1, #1                                            â”‚ â”‚
â”‚   â”‚       BNE R1, R0, loop    ; Branch back N-1 times, fall thru 1Ã—â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Branch pattern: TTTTTTTT...TTN                                â”‚ â”‚
â”‚   â”‚   (T=Taken, N=Not taken)                                        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   If we remember "last time taken", predict "taken again"       â”‚ â”‚
â”‚   â”‚   Accuracy for this loop: (N-1)/N â‰ˆ very high                   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Branch History Table (BHT):                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Simple: 1-bit predictor                                       â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚ â”‚
â”‚   â”‚   â”‚                             â”‚                                â”‚ â”‚
â”‚   â”‚   â”‚   PC â”€â”€â”€â”€â”€â–º Hash â”€â”€â”€â”€â–º Index                                â”‚ â”‚
â”‚   â”‚   â”‚                        â”‚                                     â”‚ â”‚
â”‚   â”‚   â”‚                        â–¼                                     â”‚ â”‚
â”‚   â”‚   â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚ â”‚
â”‚   â”‚   â”‚   Index    â”‚ Prediction (1 bit)â”‚                             â”‚ â”‚
â”‚   â”‚   â”‚   â”€â”€â”€â”€â”€    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚ â”‚
â”‚   â”‚   â”‚     0      â”‚        1 (Taken)  â”‚                             â”‚ â”‚
â”‚   â”‚   â”‚     1      â”‚        0 (NotTkn) â”‚                             â”‚ â”‚
â”‚   â”‚   â”‚     2      â”‚        1 (Taken)  â”‚                             â”‚ â”‚
â”‚   â”‚   â”‚    ...     â”‚       ...         â”‚                             â”‚ â”‚
â”‚   â”‚   â”‚   2^k-1    â”‚        0          â”‚                             â”‚ â”‚
â”‚   â”‚   â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚ â”‚
â”‚   â”‚   â”‚                                                              â”‚ â”‚
â”‚   â”‚   â”‚   Prediction = BHT[PC & mask]                               â”‚ â”‚
â”‚   â”‚   â”‚   After branch: Update BHT[PC & mask] = actual result       â”‚ â”‚
â”‚   â”‚   â”‚                                                              â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Œ 2-Bit Predictor (Saturating Counter)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2-BIT SATURATING COUNTER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Problem with 1-bit predictor:                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Nested loop:                                                   â”‚ â”‚
â”‚   â”‚   outer:                                                         â”‚ â”‚
â”‚   â”‚       ...                                                        â”‚ â”‚
â”‚   â”‚   inner:                                                         â”‚ â”‚
â”‚   â”‚       ...                                                        â”‚ â”‚
â”‚   â”‚       BNE R1, R0, inner   ; Inner loop branch                   â”‚ â”‚
â”‚   â”‚       ...                                                        â”‚ â”‚
â”‚   â”‚       BNE R2, R0, outer   ; Outer loop branch                   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Inner branch pattern: TTTT...TN TTTT...TN TTTT...TN          â”‚ â”‚
â”‚   â”‚   1-bit mispredicts TWICE per inner loop execution:             â”‚ â”‚
â”‚   â”‚   1. Last iteration (predicts T, actually N)                    â”‚ â”‚
â”‚   â”‚   2. First iteration of next outer (predicts N, actually T)     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Solution: 2-bit counter with 4 states                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚ â”‚
â”‚   â”‚          â”€â”€â”€â”€Nâ”€â”€â”€â”€   â”‚                 â”‚   â”€â”€â”€â”€Tâ”€â”€â”€â”€              â”‚ â”‚
â”‚   â”‚         â”‚         â”‚  â”‚                 â”‚  â”‚         â”‚             â”‚ â”‚
â”‚   â”‚         â–¼         â”‚  â–¼                 â–¼  â”‚         â–¼             â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚   â”‚   â”‚  Strong â”‚   â”‚  Weak   â”‚     â”‚  Weak   â”‚   â”‚ Strong  â”‚       â”‚ â”‚
â”‚   â”‚   â”‚   Not   â”‚â—„â”€â”€â”‚   Not   â”‚â—„â”€â”€â”€â”€â”‚  Taken  â”‚â”€â”€â–ºâ”‚  Taken  â”‚       â”‚ â”‚
â”‚   â”‚   â”‚  Taken  â”‚ N â”‚  Taken  â”‚  T  â”‚         â”‚ T â”‚         â”‚       â”‚ â”‚
â”‚   â”‚   â”‚   00    â”‚   â”‚   01    â”‚     â”‚   10    â”‚   â”‚   11    â”‚       â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚   â”‚        â”‚             â”‚               â”‚             â”‚             â”‚ â”‚
â”‚   â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ â”‚
â”‚   â”‚                         â”‚                                        â”‚ â”‚
â”‚   â”‚               Predict Not Taken    Predict Taken                â”‚ â”‚
â”‚   â”‚               (states 00, 01)      (states 10, 11)               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Must mispredict TWICE to change prediction                    â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   State Transition Table:                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Current â”‚ Actual â”‚ Next  â”‚ Prediction                          â”‚ â”‚
â”‚   â”‚   State   â”‚ Result â”‚ State â”‚ (current)                           â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚ â”‚
â”‚   â”‚     00    â”‚   N    â”‚  00   â”‚ Not Taken (Correct)                 â”‚ â”‚
â”‚   â”‚     00    â”‚   T    â”‚  01   â”‚ Not Taken (Wrong)                   â”‚ â”‚
â”‚   â”‚     01    â”‚   N    â”‚  00   â”‚ Not Taken (Correct)                 â”‚ â”‚
â”‚   â”‚     01    â”‚   T    â”‚  10   â”‚ Not Taken (Wrong)                   â”‚ â”‚
â”‚   â”‚     10    â”‚   N    â”‚  01   â”‚ Taken (Wrong)                       â”‚ â”‚
â”‚   â”‚     10    â”‚   T    â”‚  11   â”‚ Taken (Correct)                     â”‚ â”‚
â”‚   â”‚     11    â”‚   N    â”‚  10   â”‚ Taken (Wrong)                       â”‚ â”‚
â”‚   â”‚     11    â”‚   T    â”‚  11   â”‚ Taken (Correct)                     â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Branch Target Buffer (BTB)

### ğŸ“Œ BTB Organization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BRANCH TARGET BUFFER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Problem: Even with prediction, target address not known until ID     â”‚
â”‚                                                                          â”‚
â”‚   Solution: Cache branch targets alongside predictions                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚                     BRANCH TARGET BUFFER                          â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚   â”‚   â”‚                                                           â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   PC â”€â”€â”€â”€â”¬â”€â”€â”€â”€â–º Tag Compare                              â”‚   â”‚ â”‚
â”‚   â”‚   â”‚          â”‚         â”‚                                     â”‚   â”‚ â”‚
â”‚   â”‚   â”‚          â”‚         â–¼                                     â”‚   â”‚ â”‚
â”‚   â”‚   â”‚          â–¼     â”Œâ”€â”€â”€â”€â”€â”€â”€â”                                 â”‚   â”‚ â”‚
â”‚   â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”  â”‚ Hit?  â”‚â”€â”€â”€â”€â–º Use Prediction & Target    â”‚   â”‚ â”‚
â”‚   â”‚   â”‚       â”‚Indexâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚   â”‚ â”‚
â”‚   â”‚   â”‚       â””â”€â”€â”¬â”€â”€â”˜                                            â”‚   â”‚ â”‚
â”‚   â”‚   â”‚          â”‚                                               â”‚   â”‚ â”‚
â”‚   â”‚   â”‚          â–¼                                               â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   â”‚ Index â”‚ Valid â”‚   Tag   â”‚ Target  â”‚ Prediction   â”‚   â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   â”‚   0   â”‚   1   â”‚ 0x1234  â”‚ 0x2000  â”‚     11       â”‚   â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   â”‚   1   â”‚   0   â”‚   ---   â”‚   ---   â”‚     --       â”‚   â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   â”‚   2   â”‚   1   â”‚ 0x5678  â”‚ 0x1500  â”‚     10       â”‚   â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   â”‚  ...  â”‚  ...  â”‚   ...   â”‚   ...   â”‚    ...       â”‚   â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   â”‚  n-1  â”‚   1   â”‚ 0xABCD  â”‚ 0x3200  â”‚     01       â”‚   â”‚   â”‚ â”‚
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚ â”‚
â”‚   â”‚   â”‚                                                           â”‚   â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   BTB Operation:                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   In IF stage:                                                   â”‚ â”‚
â”‚   â”‚   1. Lookup BTB using current PC                                â”‚ â”‚
â”‚   â”‚   2. If HIT and Prediction = Taken:                             â”‚ â”‚
â”‚   â”‚      â†’ Fetch from Target (next PC = BTB.Target)                 â”‚ â”‚
â”‚   â”‚   3. If MISS or Prediction = Not Taken:                         â”‚ â”‚
â”‚   â”‚      â†’ Fetch from PC+4 (normal sequential fetch)                â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   After branch resolves:                                        â”‚ â”‚
â”‚   â”‚   1. Update prediction bits                                     â”‚ â”‚
â”‚   â”‚   2. If branch taken and not in BTB: Add entry                 â”‚ â”‚
â”‚   â”‚   3. If misprediction: Flush and redirect                      â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Advanced Prediction Techniques

### ğŸ“Œ Correlating Predictors

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CORRELATING (GLOBAL) PREDICTORS                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Insight: Branch behavior often depends on OTHER branches             â”‚
â”‚                                                                          â”‚
â”‚   Example:                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   if (a == 2)          ; B1                                      â”‚ â”‚
â”‚   â”‚       a = 0;                                                     â”‚ â”‚
â”‚   â”‚   if (b == 2)          ; B2                                      â”‚ â”‚
â”‚   â”‚       b = 0;                                                     â”‚ â”‚
â”‚   â”‚   if (a != b)          ; B3                                      â”‚ â”‚
â”‚   â”‚       ...                                                        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   If B1 is taken AND B2 is taken â†’ B3 is NOT taken (a=b=0)      â”‚ â”‚
â”‚   â”‚   B3's behavior correlates with B1 and B2!                      â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   (m,n) Correlating Predictor:                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   m = number of previous branches to track (global history)      â”‚ â”‚
â”‚   â”‚   n = number of bits per predictor (local prediction)            â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Global History Register (GHR): Shift register of last m resultsâ”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚ â”‚
â”‚   â”‚   GHR: â”‚ 1 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 1 â”‚ 0 â”‚ 1 â”‚  (m=8 bits)            â”‚ â”‚
â”‚   â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚ â”‚
â”‚   â”‚              Most recent â”€â”€â”€â”€â”€â”€â”€â–º Oldest                        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Pattern History Table (PHT):                                   â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚   â”‚   â”‚                                                             â”‚â”‚ â”‚
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚â”‚ â”‚
â”‚   â”‚   â”‚   â”‚    PC     â”‚â”€â”€â”€â”    â”‚       PHT           â”‚              â”‚â”‚ â”‚
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚  (2^(m+k) entries)  â”‚              â”‚â”‚ â”‚
â”‚   â”‚   â”‚                   â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚â”‚ â”‚
â”‚   â”‚   â”‚                   â–¼    â”‚  â”‚ Index â”‚ 2-bit  â”‚ â”‚â”€â”€â–º Predict   â”‚â”‚ â”‚
â”‚   â”‚   â”‚               â”Œâ”€â”€â”€â”€â”€â”  â”‚  â”‚       â”‚ counterâ”‚ â”‚              â”‚â”‚ â”‚
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”‚ XOR â”‚â”€â”€â”¼â”€â–ºâ”‚  ...  â”‚  ...   â”‚ â”‚              â”‚â”‚ â”‚
â”‚   â”‚   â”‚   â”‚  GHR  â”‚â”€â”€â–ºâ”‚     â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚â”‚ â”‚
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚â”‚ â”‚
â”‚   â”‚   â”‚                                                             â”‚â”‚ â”‚
â”‚   â”‚   â”‚   Index = PC XOR GHR (or concatenation)                    â”‚â”‚ â”‚
â”‚   â”‚   â”‚                                                             â”‚â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Œ Tournament Predictor

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TOURNAMENT (HYBRID) PREDICTOR                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Idea: Use multiple predictors, select the best for each branch       â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚ â”‚
â”‚   â”‚                  â”‚   Local Predictor   â”‚â”€â”€â”€â”                      â”‚ â”‚
â”‚   â”‚                  â”‚ (per-branch history)â”‚   â”‚                      â”‚ â”‚
â”‚   â”‚   PC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚   â”‚                      â”‚ â”‚
â”‚   â”‚        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚   â”‚        â”‚                                   â”œâ”€â”€â”€â–ºâ”‚  MUX  â”‚â”€â”€â–º Predâ”‚ â”‚
â”‚   â”‚        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚   â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Global Predictor   â”‚â”€â”€â”€â”˜        â†‘            â”‚ â”‚
â”‚   â”‚                  â”‚ (global history)    â”‚            â”‚            â”‚ â”‚
â”‚   â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚            â”‚ â”‚
â”‚   â”‚                                                     â”‚            â”‚ â”‚
â”‚   â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚            â”‚ â”‚
â”‚   â”‚   PC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Choice Predictor   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
â”‚   â”‚                  â”‚ (which is better?)  â”‚                         â”‚ â”‚
â”‚   â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Choice Predictor: 2-bit counter                               â”‚ â”‚
â”‚   â”‚   â€¢ 00, 01: Use local predictor                                 â”‚ â”‚
â”‚   â”‚   â€¢ 10, 11: Use global predictor                                â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Update: If predictors disagree, update choice toward          â”‚ â”‚
â”‚   â”‚           the predictor that was correct                        â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Example: Alpha 21264 Tournament Predictor                             â”‚
â”‚   â€¢ Local: 1024 10-bit histories, 1024 3-bit counters                 â”‚
â”‚   â€¢ Global: 4096 2-bit counters, 12-bit global history               â”‚
â”‚   â€¢ Choice: 4096 2-bit counters                                       â”‚
â”‚   â€¢ Accuracy: ~95% on SPEC benchmarks                                 â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Return Address Stack

### ğŸ“Œ Handling Function Returns

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RETURN ADDRESS STACK (RAS)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Problem: Function return (RET/JR $ra) is an indirect branch          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   CALL func        ; Push return address                         â”‚ â”‚
â”‚   â”‚   ...              ; Return to here                              â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   func:                                                          â”‚ â”‚
â”‚   â”‚       ...                                                        â”‚ â”‚
â”‚   â”‚       RET          ; Jump to return address (indirect)           â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Return target varies based on call site!                       â”‚ â”‚
â”‚   â”‚   BTB only stores ONE target per PC                             â”‚ â”‚
â”‚   â”‚   Returns have high misprediction rate with BTB alone           â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Solution: Return Address Stack (Hardware Stack)                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   RAS Operation:                                                 â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   On CALL:               On RET:                                 â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚ â”‚
â”‚   â”‚   â”‚           â”‚          â”‚           â”‚                          â”‚ â”‚
â”‚   â”‚   â”‚  Push     â”‚          â”‚   Pop     â”‚                          â”‚ â”‚
â”‚   â”‚   â”‚  PC+4     â”‚          â”‚   &       â”‚                          â”‚ â”‚
â”‚   â”‚   â”‚  onto     â”‚          â”‚  Predict  â”‚                          â”‚ â”‚
â”‚   â”‚   â”‚  RAS      â”‚          â”‚  Target   â”‚                          â”‚ â”‚
â”‚   â”‚   â”‚           â”‚          â”‚           â”‚                          â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Example:                                                       â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚   â”‚   â”‚                                                          â”‚  â”‚ â”‚
â”‚   â”‚   â”‚   main:                  RAS (stack)                     â”‚  â”‚ â”‚
â”‚   â”‚   â”‚      call A    â”€â”€â”€â”€â”€â”€â–º   [main+4]     (push)             â”‚  â”‚ â”‚
â”‚   â”‚   â”‚   A:                                                     â”‚  â”‚ â”‚
â”‚   â”‚   â”‚      call B    â”€â”€â”€â”€â”€â”€â–º   [A+4, main+4] (push)            â”‚  â”‚ â”‚
â”‚   â”‚   â”‚   B:                                                     â”‚  â”‚ â”‚
â”‚   â”‚   â”‚      ret       â—„â”€â”€â”€â”€â”€â”€   [A+4]         (pop â†’ return A+4)â”‚  â”‚ â”‚
â”‚   â”‚   â”‚   A+4:                                                   â”‚  â”‚ â”‚
â”‚   â”‚   â”‚      ret       â—„â”€â”€â”€â”€â”€â”€   []            (pop â†’ return main+4)â”‚ â”‚
â”‚   â”‚   â”‚   main+4:                                                â”‚  â”‚ â”‚
â”‚   â”‚   â”‚                                                          â”‚  â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   RAS typically 8-32 entries                                    â”‚ â”‚
â”‚   â”‚   Accuracy: ~99%+ for returns                                   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Branch Prediction Performance

### ğŸ“Œ Prediction Accuracy Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PREDICTION ACCURACY                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Predictor Type         â”‚ Typical Accuracy                      â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚ â”‚
â”‚   â”‚   Always Not Taken       â”‚      ~40%                             â”‚ â”‚
â”‚   â”‚   Always Taken           â”‚      ~60%                             â”‚ â”‚
â”‚   â”‚   1-bit (BHT)            â”‚      ~80-85%                          â”‚ â”‚
â”‚   â”‚   2-bit (Saturating)     â”‚      ~85-90%                          â”‚ â”‚
â”‚   â”‚   Correlating (2-level)  â”‚      ~90-95%                          â”‚ â”‚
â”‚   â”‚   Tournament             â”‚      ~93-97%                          â”‚ â”‚
â”‚   â”‚   TAGE (modern)          â”‚      ~97-99%                          â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Misprediction Penalty Calculation:                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   CPI = CPI_ideal + (Branch_freq Ã— Mispredict_rate Ã— Penalty)   â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Example:                                                        â”‚ â”‚
â”‚   â”‚   â€¢ 20% branches, 5% misprediction, 15-cycle penalty             â”‚ â”‚
â”‚   â”‚   â€¢ CPI = 1 + (0.20 Ã— 0.05 Ã— 15) = 1 + 0.15 = 1.15              â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   With 10% misprediction:                                        â”‚ â”‚
â”‚   â”‚   â€¢ CPI = 1 + (0.20 Ã— 0.10 Ã— 15) = 1 + 0.30 = 1.30              â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   15% worse performance with 2Ã— misprediction rate!              â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚   Deep Pipelines Amplify the Problem:                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Pipeline Depth â”‚ Misprediction Penalty                         â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚ â”‚
â”‚   â”‚        5 stages  â”‚     2-3 cycles                                â”‚ â”‚
â”‚   â”‚       10 stages  â”‚     5-7 cycles                                â”‚ â”‚
â”‚   â”‚       15 stages  â”‚    10-15 cycles                               â”‚ â”‚
â”‚   â”‚       20 stages  â”‚    15-20 cycles                               â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â”‚   Intel Pentium 4: 20+ stages, ~20 cycle penalty                â”‚ â”‚
â”‚   â”‚   Demanded very accurate prediction (97%+)                       â”‚ â”‚
â”‚   â”‚                                                                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Summary Table

| Technique | Description | Penalty | Accuracy |
|-----------|-------------|---------|----------|
| Stall | Freeze until decision known | 1-2 cycles | N/A |
| Predict Not Taken | Always fetch PC+4 | 0 or 1 cycle | ~40% |
| Predict Taken | Always fetch target | 0 or 1 cycle | ~60% |
| Delayed Branch | Execute delay slot | 0 cycles | ~70% fillable |
| 1-bit BHT | Remember last outcome | 1+ cycles | ~80-85% |
| 2-bit Saturating | Two mispredicts to change | 1+ cycles | ~85-90% |
| BTB | Cache branch targets | 0 if hit | Depends on predictor |
| Correlating | Use global history | 1+ cycles | ~90-95% |
| Tournament | Multiple predictors | 1+ cycles | ~93-97% |
| RAS | Stack for returns | 0 if correct | ~99% |

---

## â“ Quick Revision Questions

1. **Q**: Why is the branch penalty typically larger in deeper pipelines?
   
   **A**: In deeper pipelines, more instructions are fetched before the branch decision is known. All these instructions must be flushed if the prediction is wrong, resulting in more wasted cycles.

2. **Q**: How does a 2-bit predictor improve over a 1-bit predictor?
   
   **A**: A 2-bit predictor requires two consecutive mispredictions to change its prediction direction. This prevents a single anomalous outcome (like loop exit) from changing the prediction, reducing mispredictions in nested loops.

3. **Q**: What is the purpose of a Branch Target Buffer?
   
   **A**: BTB caches the target addresses of taken branches so the target is known in the IF stage. Without BTB, even with correct prediction, the processor must wait for address calculation.

4. **Q**: How does a delayed branch work?
   
   **A**: The instruction in the delay slot (immediately after the branch) is always executed, regardless of whether the branch is taken. The compiler fills this slot with useful work to hide the branch penalty.

5. **Q**: Why is a Return Address Stack needed in addition to BTB?
   
   **A**: Function returns are indirect jumps whose target varies based on the call site. BTB stores only one target per PC, but returns can go to different addresses. RAS uses a stack to correctly predict return addresses by tracking call sequences.

6. **Q**: What is a correlating predictor?
   
   **A**: A correlating predictor uses the history of recently executed branches (global history) to predict the current branch. This exploits patterns where one branch's outcome is correlated with previous branches' outcomes.

---

## ğŸ§­ Navigation

| Previous | Up | Next |
|----------|-----|------|
| [Data Forwarding](03-data-forwarding.md) | [Unit 8 Home](README.md) | [Unit 9: Memory Organization](../09-Memory-Organization/README.md) |

---

[â† Previous Chapter](03-data-forwarding.md) | [Course Home](../README.md) | [Next Unit â†’](../09-Memory-Organization/README.md)
