# Chapter 6.5: 8259 Programmable Interrupt Controller (PIC)

## ğŸ“š Chapter Overview

The 8259 PIC manages hardware interrupts in microprocessor systems. It prioritizes multiple interrupt sources and provides vectored interrupts to the CPU. This chapter covers its architecture, command words, and programming.

---

## ğŸ¯ Learning Objectives

After completing this chapter, you will be able to:
- Understand 8259 architecture and operation
- Write Initialization Command Words (ICW)
- Write Operation Command Words (OCW)
- Configure interrupt priorities
- Cascade multiple 8259s for more interrupts

---

## 1. 8259 Introduction

### 1.1 Features

```
8259A PIC Key Features:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ Handles up to 8 interrupt inputs (IR0-IR7)
â€¢ Prioritizes interrupts (default: IR0 highest)
â€¢ Provides interrupt vector to CPU
â€¢ Cascadable up to 64 interrupts (8 Ã— 8259s)
â€¢ Programmable interrupt modes
â€¢ Individual interrupt masking
â€¢ Compatible with 8085, 8086/8088
â€¢ 28-pin DIP package
```

### 1.2 Block Diagram

```
                    8259A BLOCK DIAGRAM
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        8259A PIC                          â”‚
    â”‚                                                           â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚   â”‚ Interrupt â”‚    â”‚  Priority â”‚    â”‚   In      â”‚        â”‚
    â”‚   â”‚  Request  â”‚â”€â”€â”€â–ºâ”‚  Resolver â”‚â”€â”€â”€â–ºâ”‚  Service  â”‚        â”‚
    â”‚   â”‚ Register  â”‚    â”‚   (PR)    â”‚    â”‚ Register  â”‚        â”‚
    â”‚   â”‚  (IRR)    â”‚    â”‚           â”‚    â”‚   (ISR)   â”‚        â”‚
    â”‚   â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
    â”‚         â”‚                                  â”‚              â”‚
    â”‚   IR0 â”€â”€â”¤                                  â”‚              â”‚
    â”‚   IR1 â”€â”€â”¤                                  â–¼              â”‚
    â”‚   IR2 â”€â”€â”¤                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
    â”‚   IR3 â”€â”€â”¤                          â”‚ Interrupt â”‚         â”‚
    â”‚   IR4 â”€â”€â”¤                          â”‚  Mask     â”‚         â”‚
    â”‚   IR5 â”€â”€â”¤                          â”‚ Register  â”‚         â”‚
    â”‚   IR6 â”€â”€â”¤                          â”‚  (IMR)    â”‚         â”‚
    â”‚   IR7 â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
    â”‚                                           â”‚               â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚               â”‚
    â”‚   â”‚  Control  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
    â”‚   â”‚   Logic   â”‚                                          â”‚
    â”‚   â”‚           â”‚                                          â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                          â”‚
    â”‚         â”‚                                                 â”‚
    â”‚         â–¼                                                 â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
    â”‚   â”‚Data Bus   â”‚    â”‚  Cascade  â”‚                         â”‚
    â”‚   â”‚ Buffer    â”‚â—„â”€â”€â–ºâ”‚  Buffer/  â”‚â—„â”€â”€â–º CAS0-2              â”‚
    â”‚   â”‚  D0-D7    â”‚    â”‚Comparator â”‚    SPÌ„/Ä’N                â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
    â”‚                                                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Key Registers:
    â€¢ IRR: Interrupt Request Register - stores pending requests
    â€¢ ISR: In-Service Register - stores currently serviced interrupt
    â€¢ IMR: Interrupt Mask Register - masks/unmasks interrupts
```

### 1.3 Pin Diagram

```
                    8259A PIN DIAGRAM
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
           CÌ„SÌ„  â”€â”€â”€â”¤ 1            28 â”œâ”€â”€â”€ Vcc
           WRÌ„  â”€â”€â”€â”¤ 2            27 â”œâ”€â”€â”€ A0
           RDÌ„  â”€â”€â”€â”¤ 3            26 â”œâ”€â”€â”€ INTAÌ…
           D7  â”€â”€â”€â”¤ 4            25 â”œâ”€â”€â”€ IR7
           D6  â”€â”€â”€â”¤ 5            24 â”œâ”€â”€â”€ IR6
           D5  â”€â”€â”€â”¤ 6            23 â”œâ”€â”€â”€ IR5
           D4  â”€â”€â”€â”¤ 7            22 â”œâ”€â”€â”€ IR4
           D3  â”€â”€â”€â”¤ 8            21 â”œâ”€â”€â”€ IR3
           D2  â”€â”€â”€â”¤ 9            20 â”œâ”€â”€â”€ IR2
           D1  â”€â”€â”€â”¤ 10           19 â”œâ”€â”€â”€ IR1
           D0  â”€â”€â”€â”¤ 11           18 â”œâ”€â”€â”€ IR0
          CAS0 â”€â”€â”€â”¤ 12           17 â”œâ”€â”€â”€ INT
          CAS1 â”€â”€â”€â”¤ 13           16 â”œâ”€â”€â”€ SPÌ„/Ä’N
          GND  â”€â”€â”€â”¤ 14           15 â”œâ”€â”€â”€ CAS2
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Pin Functions:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pin        â”‚ Function                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ D0-D7      â”‚ Bidirectional data bus                     â”‚
â”‚ IR0-IR7    â”‚ Interrupt request inputs                   â”‚
â”‚ INT        â”‚ Interrupt output to CPU                    â”‚
â”‚ INTAÌ…       â”‚ Interrupt acknowledge from CPU             â”‚
â”‚ A0         â”‚ Command/Status select                      â”‚
â”‚ RDÌ„, WRÌ„     â”‚ Read/Write control                         â”‚
â”‚ CÌ„SÌ„         â”‚ Chip select                                â”‚
â”‚ SPÌ„/Ä’N      â”‚ Slave Program/Enable buffer               â”‚
â”‚ CAS0-2     â”‚ Cascade lines                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Interrupt Sequence

### 2.1 Interrupt Handling Flow

```
INTERRUPT HANDLING SEQUENCE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Device requests interrupt (IR line goes HIGH)
             â”‚
             â–¼
2. 8259 sets bit in IRR (Interrupt Request Register)
             â”‚
             â–¼
3. Priority resolver checks IRR and IMR
   (Selects highest priority unmasked interrupt)
             â”‚
             â–¼
4. 8259 sends INT signal to CPU
             â”‚
             â–¼
5. CPU completes current instruction
             â”‚
             â–¼
6. CPU sends INTAÌ… pulse #1
   (8259 sets bit in ISR, clears bit in IRR)
             â”‚
             â–¼
7. CPU sends INTAÌ… pulse #2
   (8259 puts interrupt vector on data bus)
             â”‚
             â–¼
8. CPU reads vector and jumps to ISR
             â”‚
             â–¼
9. ISR executes
             â”‚
             â–¼
10. ISR sends EOI to 8259 (clears ISR bit)
             â”‚
             â–¼
11. RET from ISR, CPU resumes
```

### 2.2 Timing Diagram

```
INTERRUPT TIMING
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

IR    â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INT   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INTAÌ…  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                        â””â”€â”€â”€â”˜       â””â”€â”€â”€â”˜
                         â”‚           â”‚
                       INTA1      INTA2
                     (Set ISR)   (Send Vector)

DATA  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€XXXXXXXXâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                   â”‚Vectorâ”‚
```

---

## 3. Command Words

### 3.1 Overview

```
8259A COMMAND WORDS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Initialization Command Words (ICW):
â€¢ ICW1: Start initialization, edge/level trigger
â€¢ ICW2: Vector base address
â€¢ ICW3: Cascade configuration (master/slave)
â€¢ ICW4: Mode selection (8085/8086, EOI mode, etc.)

Operation Command Words (OCW):
â€¢ OCW1: Interrupt mask register
â€¢ OCW2: EOI commands, priority rotation
â€¢ OCW3: Read IRR/ISR, special mask mode

Initialization Sequence:
â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ ICW1 â”‚â”€â”€â”€â–º Must be written first
â””â”€â”€â”¬â”€â”€â”€â”˜
   â”‚ A0=0
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ ICW2 â”‚â”€â”€â”€â–º Vector base address
â””â”€â”€â”¬â”€â”€â”€â”˜
   â”‚ A0=1
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ ICW3 â”‚â”€â”€â”€â–º Only if cascade mode (IC3=1 in ICW1)
â””â”€â”€â”¬â”€â”€â”€â”˜
   â”‚ A0=1
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ ICW4 â”‚â”€â”€â”€â–º Only if IC4=1 in ICW1
â””â”€â”€â”€â”€â”€â”€â”˜
   A0=1
```

### 3.2 ICW1 - Initialization Command Word 1

```
ICW1 FORMAT (A0 = 0)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  D7   D6   D5   D4   D3   D2   D1   D0
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ A7 â”‚ A6 â”‚ A5 â”‚ 1  â”‚LTIMâ”‚ADI â”‚SNGLâ”‚IC4 â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â””â”€â”€â”€ ICW4 Needed
  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚         0 = No ICW4
  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚         1 = ICW4 needed
  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€ Single/Cascade
  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚              0 = Cascade mode
  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚              1 = Single mode
  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
  â”‚    â”‚    â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Address Interval
  â”‚    â”‚    â”‚    â”‚    â”‚                   0 = 8 (8086)
  â”‚    â”‚    â”‚    â”‚    â”‚                   1 = 4 (8085)
  â”‚    â”‚    â”‚    â”‚    â”‚
  â”‚    â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Level/Edge Trigger
  â”‚    â”‚    â”‚    â”‚                        0 = Edge triggered
  â”‚    â”‚    â”‚    â”‚                        1 = Level triggered
  â”‚    â”‚    â”‚    â”‚
  â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Must be 1 (ICW1 flag)
  â”‚    â”‚    â”‚
  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ A7-A5 (8085 only)
                                          Bits 7-5 of vector

Example:
â€¢ 8086 mode, edge trigger, cascade, ICW4 needed:
  ICW1 = 0001 0001 = 11H
```

### 3.3 ICW2 - Initialization Command Word 2

```
ICW2 FORMAT (A0 = 1)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

For 8086/8088:
  D7   D6   D5   D4   D3   D2   D1   D0
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ T7 â”‚ T6 â”‚ T5 â”‚ T4 â”‚ T3 â”‚ 0  â”‚ 0  â”‚ 0  â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â””â”€â”€â”€ Vector address bits 7-3
                    (IR number fills bits 2-0)

For 8085:
  D7   D6   D5   D4   D3   D2   D1   D0
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ A15â”‚ A14â”‚ A13â”‚ A12â”‚ A11â”‚ A10â”‚ A9 â”‚ A8 â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â””â”€â”€â”€ Address bits 15-8
                        (Combined with ICW1 A7-A5)

Examples:
â€¢ 8086, vectors at 08H-0FH: ICW2 = 08H
â€¢ 8086, vectors at 20H-27H: ICW2 = 20H
â€¢ 8086, vectors at 70H-77H: ICW2 = 70H
```

### 3.4 ICW3 - Initialization Command Word 3

```
ICW3 FORMAT (A0 = 1, only in cascade mode)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

For MASTER 8259:
  D7   D6   D5   D4   D3   D2   D1   D0
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ S7 â”‚ S6 â”‚ S5 â”‚ S4 â”‚ S3 â”‚ S2 â”‚ S1 â”‚ S0 â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€ Slave on IRn
                                           1 = Slave connected
                                           0 = No slave

Example: Slave on IR2: ICW3 = 0000 0100 = 04H

For SLAVE 8259:
  D7   D6   D5   D4   D3   D2   D1   D0
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ 0  â”‚ 0  â”‚ 0  â”‚ 0  â”‚ 0  â”‚ID2 â”‚ID1 â”‚ID0 â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â””â”€â”€â”€ Slave ID (0-7)
                                      (IR input of master)

Example: Slave connected to IR2: ICW3 = 0000 0010 = 02H
```

### 3.5 ICW4 - Initialization Command Word 4

```
ICW4 FORMAT (A0 = 1, if IC4=1 in ICW1)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  D7   D6   D5   D4   D3   D2   D1   D0
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ 0  â”‚ 0  â”‚ 0  â”‚SFNMâ”‚BUF â”‚M/SÌ„ â”‚AEOIâ”‚Î¼PM â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
                 â”‚    â”‚    â”‚    â”‚    â”‚
                 â”‚    â”‚    â”‚    â”‚    â””â”€â”€â”€ Î¼P Mode
                 â”‚    â”‚    â”‚    â”‚         0 = 8085 mode
                 â”‚    â”‚    â”‚    â”‚         1 = 8086/8088 mode
                 â”‚    â”‚    â”‚    â”‚
                 â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€ Auto EOI
                 â”‚    â”‚    â”‚              0 = Normal EOI
                 â”‚    â”‚    â”‚              1 = Auto EOI
                 â”‚    â”‚    â”‚
                 â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Master/Slave
                 â”‚    â”‚                   (when BUF=1)
                 â”‚    â”‚                   0 = Slave
                 â”‚    â”‚                   1 = Master
                 â”‚    â”‚
                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Buffered Mode
                 â”‚                        0 = Non-buffered
                 â”‚                        1 = Buffered
                 â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Special Fully Nested
                                          0 = Not special
                                          1 = Special FNM

Examples:
â€¢ 8086 mode, normal EOI: ICW4 = 0000 0001 = 01H
â€¢ 8086 mode, auto EOI:   ICW4 = 0000 0011 = 03H
```

### 3.6 OCW1 - Operation Command Word 1

```
OCW1 FORMAT (A0 = 1, Interrupt Mask Register)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  D7   D6   D5   D4   D3   D2   D1   D0
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ M7 â”‚ M6 â”‚ M5 â”‚ M4 â”‚ M3 â”‚ M2 â”‚ M1 â”‚ M0 â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€ Interrupt Mask
                                           1 = Masked (disabled)
                                           0 = Enabled

Examples:
â€¢ Mask all except IR0: OCW1 = 1111 1110 = FEH
â€¢ Mask IR7 only:       OCW1 = 1000 0000 = 80H
â€¢ Enable all:          OCW1 = 0000 0000 = 00H
```

### 3.7 OCW2 - Operation Command Word 2

```
OCW2 FORMAT (A0 = 0, EOI and Priority)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  D7   D6   D5   D4   D3   D2   D1   D0
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ R  â”‚ SL â”‚EOI â”‚ 0  â”‚ 0  â”‚ L2 â”‚ L1 â”‚ L0 â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
  â”‚    â”‚    â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
  â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”˜         â”‚
  â”‚    â”‚    â”‚    Must be 0      â””â”€â”€â”€ IR level (when SL=1)
  â”‚    â”‚    â”‚
  â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ EOI Command
  â”‚    â”‚                                1 = Issue EOI
  â”‚    â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Specific Level
  â”‚                                     0 = Current level
  â”‚                                     1 = Specific (L2-L0)
  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Rotate
                                        0 = No rotation
                                        1 = Rotate priority

Command Combinations:
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ R  â”‚ SL â”‚EOI â”‚ Command                         â”‚ Hex  â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ 0  â”‚ 1  â”‚ Non-specific EOI                â”‚ 20H  â”‚
â”‚ 0  â”‚ 1  â”‚ 1  â”‚ Specific EOI (L2-L0)            â”‚ 6xH  â”‚
â”‚ 1  â”‚ 0  â”‚ 1  â”‚ Rotate on non-specific EOI      â”‚ A0H  â”‚
â”‚ 1  â”‚ 1  â”‚ 1  â”‚ Rotate on specific EOI          â”‚ ExH  â”‚
â”‚ 1  â”‚ 0  â”‚ 0  â”‚ Rotate in auto EOI mode (set)   â”‚ 80H  â”‚
â”‚ 0  â”‚ 0  â”‚ 0  â”‚ Rotate in auto EOI mode (clear) â”‚ 00H  â”‚
â”‚ 1  â”‚ 1  â”‚ 0  â”‚ Set priority command            â”‚ CxH  â”‚
â”‚ 0  â”‚ 1  â”‚ 0  â”‚ No operation                    â”‚ 40H  â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

### 3.8 OCW3 - Operation Command Word 3

```
OCW3 FORMAT (A0 = 0)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  D7   D6   D5   D4   D3   D2   D1   D0
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ 0  â”‚ESMMâ”‚SMM â”‚ 0  â”‚ 1  â”‚ P  â”‚ RR â”‚ RISâ”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
        â”‚    â”‚         â”‚    â”‚    â”‚    â”‚
        â”‚    â”‚         â”‚    â”‚    â”‚    â””â”€â”€â”€ Read ISR/IRR
        â”‚    â”‚         â”‚    â”‚    â”‚         0 = Read IRR
        â”‚    â”‚         â”‚    â”‚    â”‚         1 = Read ISR
        â”‚    â”‚         â”‚    â”‚    â”‚
        â”‚    â”‚         â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€ Read Register
        â”‚    â”‚         â”‚    â”‚              0 = No effect
        â”‚    â”‚         â”‚    â”‚              1 = Read register
        â”‚    â”‚         â”‚    â”‚
        â”‚    â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Poll Command
        â”‚    â”‚         â”‚                   0 = No poll
        â”‚    â”‚         â”‚                   1 = Poll command
        â”‚    â”‚         â”‚
        â”‚    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Must be 01
        â”‚    â”‚
        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Special Mask Mode
        â”‚                                  (only if ESMM=1)
        â”‚                                  0 = Reset SMM
        â”‚                                  1 = Set SMM
        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Enable SMM Command
                                           0 = No effect
                                           1 = Enable SMM cmd

Commands:
â€¢ Read IRR: OCW3 = 0000 1010 = 0AH
â€¢ Read ISR: OCW3 = 0000 1011 = 0BH
â€¢ Poll:     OCW3 = 0000 1100 = 0CH
```

---

## 4. Priority Modes

### 4.1 Fixed Priority

```
FIXED PRIORITY (Default)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

IR0 = Highest priority
IR7 = Lowest priority

Priority Order:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IR0 > IR1 > IR2 > IR3 >       â”‚
â”‚  IR4 > IR5 > IR6 > IR7         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

If IR3 is being serviced and IR1 arrives:
â€¢ IR1 interrupts IR3 (higher priority)

If IR3 is being serviced and IR5 arrives:
â€¢ IR5 waits until IR3 finishes (lower priority)
```

### 4.2 Rotating Priority

```
ROTATING PRIORITY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Priority rotates after service
Last serviced becomes lowest priority

Example sequence:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Initially:   IR0 > IR1 > IR2 > ... > IR7          â”‚
â”‚                                                   â”‚
â”‚ After IR3 serviced (with rotation):               â”‚
â”‚              IR4 > IR5 > IR6 > IR7 > IR0 > IR1 >  â”‚
â”‚              IR2 > IR3 (now lowest)               â”‚
â”‚                                                   â”‚
â”‚ After IR6 serviced:                               â”‚
â”‚              IR7 > IR0 > IR1 > IR2 > IR3 > IR4 >  â”‚
â”‚              IR5 > IR6 (now lowest)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Use: Equal priority for all devices
Commands: OCW2 with R=1
```

---

## 5. Cascading Multiple 8259s

### 5.1 Cascade Configuration

```
CASCADING 8259s (Up to 64 interrupts)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

                          MASTER 8259
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          IR0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚
          IR1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚
    â”Œâ”€â”€â”€â”€â”€IR2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”œâ”€â”€â”€â”€ INT â”€â”€â–º CPU
    â”‚     IR3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   8259    â”‚
    â”‚     IR4 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚â—„â”€â”€â”€ INTAÌ… â”€â”
    â”‚     IR5 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚           â”‚
    â”‚     IR6 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚           â”‚
    â”‚     IR7 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚           â”‚
    â”‚                    â”‚     CAS   â”‚           â”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚
    â”‚                          â”‚                 â”‚
    â”‚                     CAS0-2                 â”‚
    â”‚                          â”‚                 â”‚
    â”‚                          â–¼                 â”‚
    â”‚                    SLAVE 8259              â”‚
    â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
    â”‚    IR8 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚            â”‚
    â”‚    IR9 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚            â”‚
    â”‚   IR10 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚            â”‚
    â”‚   IR11 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   8259    â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  (Slave)  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        INT11          â”‚           â”‚     INTAÌ…
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Master ICW3: 04H (slave on IR2)
Slave ICW3: 02H (slave ID = 2)
```

### 5.2 IBM PC Dual 8259 Configuration

```
PC/AT INTERRUPT CONFIGURATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Master 8259 (Port 20H-21H):        Slave 8259 (Port A0H-A1H):
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚IRQ â”‚ Device                 â”‚    â”‚ IRQ â”‚ Device             â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ System Timer           â”‚    â”‚  8  â”‚ Real-time Clock    â”‚
â”‚ 1  â”‚ Keyboard               â”‚    â”‚  9  â”‚ Redirected IRQ2    â”‚
â”‚ 2  â”‚ Cascade to Slave       â”‚    â”‚ 10  â”‚ Available          â”‚
â”‚ 3  â”‚ COM2/COM4              â”‚    â”‚ 11  â”‚ Available          â”‚
â”‚ 4  â”‚ COM1/COM3              â”‚    â”‚ 12  â”‚ PS/2 Mouse         â”‚
â”‚ 5  â”‚ LPT2/Sound Card        â”‚    â”‚ 13  â”‚ Math Coprocessor   â”‚
â”‚ 6  â”‚ Floppy Disk            â”‚    â”‚ 14  â”‚ Primary IDE        â”‚
â”‚ 7  â”‚ LPT1                   â”‚    â”‚ 15  â”‚ Secondary IDE      â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Vectors:
â€¢ IRQ0-IRQ7  â†’ INT 08H-0FH
â€¢ IRQ8-IRQ15 â†’ INT 70H-77H
```

---

## 6. Programming Examples

### 6.1 8259 Initialization (8085)

```asm
;------------------------------------------------
; Initialize single 8259 for 8085
;------------------------------------------------

ICW1    EQU 20H         ; Command port
OCW     EQU 21H         ; Data port

INIT_8259:
        ; ICW1: Edge trigger, single, need ICW4
        MVI A, 17H      ; 0001 0111
        OUT ICW1
        
        ; ICW2: Vector base = 40H (8085 style)
        MVI A, 40H
        OUT OCW
        
        ; ICW4: 8085 mode
        MVI A, 00H      ; 0000 0000 (8085 mode)
        OUT OCW
        
        ; OCW1: Unmask all interrupts
        MVI A, 00H
        OUT OCW
        
        RET
```

### 6.2 8259 Initialization (8086)

```asm
;------------------------------------------------
; Initialize 8259 for 8086 in single mode
; Vectors at 08H-0FH
;------------------------------------------------
.MODEL SMALL
.CODE

MASTER_CMD  EQU 20H
MASTER_DATA EQU 21H

INIT_8259 PROC
        ; ICW1: Edge trigger, single, ICW4 needed
        MOV AL, 13H         ; 0001 0011
        OUT MASTER_CMD, AL
        
        ; ICW2: Vector base = 08H
        MOV AL, 08H
        OUT MASTER_DATA, AL
        
        ; ICW4: 8086 mode, normal EOI
        MOV AL, 01H         ; 0000 0001
        OUT MASTER_DATA, AL
        
        ; OCW1: Enable all interrupts
        MOV AL, 00H
        OUT MASTER_DATA, AL
        
        RET
INIT_8259 ENDP
```

### 6.3 PC Dual 8259 Initialization

```asm
;------------------------------------------------
; Initialize PC/AT dual 8259s
;------------------------------------------------

MASTER_CMD  EQU 20H
MASTER_DATA EQU 21H
SLAVE_CMD   EQU 0A0H
SLAVE_DATA  EQU 0A1H

INIT_PICS PROC
        ; ICW1 for both
        MOV AL, 11H         ; Edge, cascade, ICW4 needed
        OUT MASTER_CMD, AL
        OUT SLAVE_CMD, AL
        
        ; ICW2: Vector bases
        MOV AL, 08H         ; Master: INT 08H-0FH
        OUT MASTER_DATA, AL
        MOV AL, 70H         ; Slave: INT 70H-77H
        OUT SLAVE_DATA, AL
        
        ; ICW3
        MOV AL, 04H         ; Master: Slave on IR2
        OUT MASTER_DATA, AL
        MOV AL, 02H         ; Slave: ID = 2
        OUT SLAVE_DATA, AL
        
        ; ICW4
        MOV AL, 01H         ; 8086 mode
        OUT MASTER_DATA, AL
        OUT SLAVE_DATA, AL
        
        ; OCW1: Mask all except IR0, IR1, IR2
        MOV AL, 0F8H
        OUT MASTER_DATA, AL
        MOV AL, 0FFH        ; Mask all slave
        OUT SLAVE_DATA, AL
        
        RET
INIT_PICS ENDP
```

### 6.4 End of Interrupt (EOI)

```asm
;------------------------------------------------
; Send EOI to 8259 at end of ISR
;------------------------------------------------

; Non-specific EOI (clears highest priority in-service)
SEND_EOI:
        MOV AL, 20H         ; OCW2: Non-specific EOI
        OUT 20H, AL         ; To master
        RET

; Specific EOI for IR3
SEND_EOI_IR3:
        MOV AL, 63H         ; OCW2: Specific EOI, level 3
        OUT 20H, AL
        RET

; EOI for slave interrupt (must send to both)
SEND_EOI_SLAVE:
        MOV AL, 20H         ; Non-specific EOI
        OUT 0A0H, AL        ; To slave first
        OUT 20H, AL         ; Then to master
        RET
```

### 6.5 Reading IRR and ISR

```asm
;------------------------------------------------
; Read 8259 registers
;------------------------------------------------

READ_IRR:
        MOV AL, 0AH         ; OCW3: Read IRR
        OUT 20H, AL
        IN  AL, 20H         ; AL = IRR
        RET

READ_ISR:
        MOV AL, 0BH         ; OCW3: Read ISR
        OUT 20H, AL
        IN  AL, 20H         ; AL = ISR
        RET
```

---

## ğŸ“‹ Summary Table

| Command | Port | D7-D0 | Function |
|---------|------|-------|----------|
| ICW1 | A0=0 | 0001xxxx | Start init, edge/level |
| ICW2 | A0=1 | xxxxxxxx | Vector base |
| ICW3 | A0=1 | xxxxxxxx | Cascade config |
| ICW4 | A0=1 | 000xxxxx | 8085/86 mode, EOI |
| OCW1 | A0=1 | xxxxxxxx | Interrupt mask |
| OCW2 | A0=0 | xxx00xxx | EOI, priority |
| OCW3 | A0=0 | 0xx01xxx | Read IRR/ISR |

---

## â“ Quick Revision Questions

1. **What are the ICWs needed to initialize 8259 for 8086, single mode, edge trigger?**
   <details>
   <summary>Show Answer</summary>
   ICW1 = 13H (0001 0011): D4=1, LTIM=0 (edge), SNGL=1 (single), IC4=1
   ICW2 = xxH: Vector base (e.g., 08H for INT 08H-0FH)
   ICW4 = 01H (0000 0001): Î¼PM=1 (8086 mode)
   ICW3 is not needed in single mode.
   </details>

2. **What is the difference between specific and non-specific EOI?**
   <details>
   <summary>Show Answer</summary>
   Non-specific EOI (OCW2=20H): Clears the highest priority bit in ISR automatically.
   Specific EOI (OCW2=6xH): Clears a specific interrupt level specified in L2-L0.
   Use specific EOI when the highest ISR bit may not be the one you want to clear.
   </details>

3. **How do you mask IR5 while leaving others unchanged?**
   <details>
   <summary>Show Answer</summary>
   1. Read current mask: IN AL, 21H
   2. Set bit 5: OR AL, 20H (0010 0000)
   3. Write back: OUT 21H, AL
   Or if setting all at once, write OCW1 with bit 5 = 1.
   </details>

4. **Why must EOI be sent to slave first in cascade mode?**
   <details>
   <summary>Show Answer</summary>
   The slave's INT line is connected to master's IR2. If you clear master's ISR first, the master might see the slave's INT still active and think there's a new interrupt. Sending EOI to slave first clears the slave's ISR, removing its INT signal, then clear the master.
   </details>

5. **What does rotating priority accomplish?**
   <details>
   <summary>Show Answer</summary>
   Rotating priority ensures all devices get equal access. After servicing an interrupt, that level becomes lowest priority. This prevents a high-priority device from starving lower-priority devices when it generates frequent interrupts.
   </details>

6. **How many total interrupts can be handled with one master and 8 slaves?**
   <details>
   <summary>Show Answer</summary>
   Maximum is 64 interrupts. Each slave provides 8 interrupt inputs, and the master can connect to 8 slaves (using IR0-IR7). However, practically it's 64 because each master IR used for cascade loses one direct interrupt input.
   </details>

---

## ğŸ§­ Navigation

| Previous | Up | Next |
|----------|-----|------|
| [6.4 8253 Timer](04-8253-timer.md) | [Unit 6 Index](README.md) | [6.6 DMA Controller](06-dma-controller.md) |

---

*[â† Previous: 8253 Timer](04-8253-timer.md) | [Next: DMA Controller â†’](06-dma-controller.md)*
